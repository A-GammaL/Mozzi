
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Examples - MOZZI</title>
  <meta name="author" content="Tim Barrass">
  
  
  <meta name="description" content="Mozzi is a sound synthesis software library for Arduino." />

  
  <meta name="keywords" content="Applications : sound, music, audio, synthesis, sound art, electronic music, sonification, media art, performance, installation, electronic art, creative art, interactive art, Software: library, arduino, open source, extendable, free, Audience: artists, scientists, teachers, learners, students, hobby, do it yourself, diy, makers, creators, musicians, engineers, collaborators" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sensorium.github.io/Mozzi//examples">
  <link href="/Mozzi/favicon.png" rel="icon">
  <link href="/Mozzi/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/Mozzi/atom.xml" rel="alternate" title="MOZZI" type="application/atom+xml">
  <script src="/Mozzi/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/Mozzi/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<link href='http://fonts.googleapis.com/css?family=Londrina+Solid&text=MOZZI' rel='stylesheet' type='text/css'>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32577259-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner">
<div id="header_wrap">
	
	<hgroup>
		<h1 id="banner_main_title"><a href="/Mozzi/">MOZZI</a></h1>
		
		
			<h2>sound synthesis library for Arduino</h2>
		
	</hgroup>
	
	<img src="/Mozzi/images/mozzi-circle.gif" id="mozzi_logo"/> 
	<img src="/Mozzi/images/lee.gif" id="lee"/>

	<section id="header_links_section">
		<p>
			<a  class="header_link" href="https://github.com/sensorium/Mozzi"> 
				<span id="header_small_label">View on <i class="icon-github icon-2x"></i> GitHub</span>
			</a>
		</p>
		<p>
			<a class="header_link" href="https://github.com/sensorium/Mozzi/zipball/master">
				download<br>
				<i class="icon-download icon-4x"></i><br>
				<span id="header_small_label">version 2013-07-13-17:27</span>
			</a>
		</p>
	</section> 

</div>



</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/Mozzi/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <!-- <input type="hidden" name="q" value="site:sensorium.github.io/Mozzi/" /> -->
    <input type="hidden" name="q" value="http://sensorium.github.io/Mozzi/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/Mozzi/">Home</a></li>
  <li><a href="/Mozzi/examples/">Examples</a></li>
  <li><a href="/Mozzi/learn/">Learn</a></li>
  <li><a href="/Mozzi/gallery/">Gallery</a></li>
  <li><a href="/Mozzi/faq/">FAQ</a></li>
  <li><a href="https://groups.google.com/forum/#!forum/mozzi-users/">Forum</a></li>
  <li><a href="http://sensorium.github.com/Mozzi/doc/html/index.html">API</a></li>
  <!-- <li><a href="/Mozzi/blog/">Blog</a></li> -->
  <!-- <li><a href="/Mozzi/resources/">Resources</a></li>   -->
  <!-- <li><a href="/Mozzi/blog/archives/">Archives</a></li>
  <li><a href="/Mozzi/about/">About</a></li> -->
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Examples</h1>
    
  </header>
  
  <p><a name = "top"> </a>These are the example sketches that come with Mozzi, and the sounds they make.
They&#8217;re intended to be instructive, rather than musically interesting&#8230;</p>

<p><a href="#01.Basics">01.Basics</a> : how to make a sound and simple modifications like gain.<br/>
<a href="#02.Control">02.Control</a> : changing sound parameters, scheduling, pausing.<br/>
<a href="#03.Sensors">03.Sensors</a> : using various sensors to change sounds.<br/>
<a href="#04.Analog_Input">04.Analog Input</a> : ways to read analog inputs to minimise audio glitches.<br/>
<a href="#05.Control_Filters">05.Control Filters</a> : smoothing and other processing for sensor inputs.<br/>
<a href="#06.Synthesis">06.Synthesis</a> : for more versatile and detailed sounds.<br/>
<a href="#07.Envelopes">07.Envelopes</a> : give sounds changing dynamics.<br/>
<a href="#08.Samples">08.Samples</a> : play recorded sounds in various ways.<br/>
<a href="#09.Delays">09.Delays</a> : for effects like flanging or reverb.<br/>
<a href="#10.Audio_Filters">10.Audio Filters</a> : modify audio frequencies.<br/>
<a href="#11.Communication">11.Communication</a> : non-blocking communication with external devices.</p>

<h2 class=target_without_link><a id='01.Basics'>
01.Basics</a></h2>


<hr />

<p>Control_Gain <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Control_Gain/Control_Gain.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Control_Gain/Control_Gain.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Control_Gainexpand' onclick='javascript:toggleDisplay(Control_Gain, Control_Gainexpand, Control_Gaincollapse)'>show sketch</button>
<button id='Control_Gaincollapse' style='display:none' onclick='javascript:toggleDisplay(Control_Gain, Control_Gainexpand, Control_Gaincollapse)'>hide sketch</button></p>

<div id='Control_Gain' style='display:none'>
<figure class='code'><figcaption><span> (Control_Gain.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Control_Gain/Control_Gain.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example changing the gain of a sinewave,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates the use of a control variable to influence an</span>
</span><span class='line'><span class="cm"> *  audio signal.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// control variable, use the smallest data size you can for anything used in audio</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gain</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// start with default control rate of 64</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">3320</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// as unsigned char, this will automatically roll around to 255 when it passes 0</span>
</span><span class='line'>  <span class="n">gain</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">-</span> <span class="mi">3</span> <span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span> <span class="n">gain</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back to STANDARD audio range, like /256 but faster</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Sinewave <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave/Sinewave.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave/Sinewave.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Sinewaveexpand' onclick='javascript:toggleDisplay(Sinewave, Sinewaveexpand, Sinewavecollapse)'>show sketch</button>
<button id='Sinewavecollapse' style='display:none' onclick='javascript:toggleDisplay(Sinewave, Sinewaveexpand, Sinewavecollapse)'>hide sketch</button></p>

<div id='Sinewave' style='display:none'>
<figure class='code'><figcaption><span> (Sinewave.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Sinewave/Sinewave.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing a sinewave at a set frequency,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates the use of Oscil to play a wavetable.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// put changing controls in here</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// return an int signal centred around 0</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Sinewave_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave_HIFI/Sinewave_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave_HIFI/Sinewave_HIFI.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Sinewave_HIFIexpand' onclick='javascript:toggleDisplay(Sinewave_HIFI, Sinewave_HIFIexpand, Sinewave_HIFIcollapse)'>show sketch</button>
<button id='Sinewave_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(Sinewave_HIFI, Sinewave_HIFIexpand, Sinewave_HIFIcollapse)'>hide sketch</button></p>

<div id='Sinewave_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (Sinewave_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Sinewave_HIFI/Sinewave_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing a sinewave at a set frequency,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates the use of Oscil to play a wavetable.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm"> *  be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm"> *  In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm"> *  #define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm"> *  //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm"> *  to</span>
</span><span class='line'><span class="cm"> *  //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm"> *  #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm"> *  Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *                   3.9k </span>
</span><span class='line'><span class="cm"> *   pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm"> *                     1M           |</span>
</span><span class='line'><span class="cm"> *   pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm"> *                                     |</span>
</span><span class='line'><span class="cm"> *                           4.7n  ==</span>
</span><span class='line'><span class="cm"> *                                     |</span>
</span><span class='line'><span class="cm"> *                                 ground</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Resistors are ±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm"> *  from a batch of whatever you can get.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012-13.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// uses the default control rate of 64, defined in mozzi_config.h</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// this would make more sense with a higher resolution signal</span>
</span><span class='line'>  <span class="c1">// but still benefits from using HIFI to avoid the 16kHz pwm noise</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="c1">// 8 bits scaled up to 14 bits</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Skeleton <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='Skeletonexpand' onclick='javascript:toggleDisplay(Skeleton, Skeletonexpand, Skeletoncollapse)'>show sketch</button>
<button id='Skeletoncollapse' style='display:none' onclick='javascript:toggleDisplay(Skeleton, Skeletonexpand, Skeletoncollapse)'>hide sketch</button></p>

<div id='Skeleton' style='display:none'>
<figure class='code'><figcaption><span> (Skeleton.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Skeleton/Skeleton.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;        </span><span class="c1">// at the top of your sketch</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64   </span><span class="c1">// or some other power of 2</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// your control code</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// your audio code which returns an int between -244 and 243</span>
</span><span class='line'>  <span class="c1">// actually, a char is fine</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// fills the audio buffer</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Table_Resolution <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Table_Resolution/Table_Resolution.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Table_Resolution/Table_Resolution.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Table_Resolutionexpand' onclick='javascript:toggleDisplay(Table_Resolution, Table_Resolutionexpand, Table_Resolutioncollapse)'>show sketch</button>
<button id='Table_Resolutioncollapse' style='display:none' onclick='javascript:toggleDisplay(Table_Resolution, Table_Resolutionexpand, Table_Resolutioncollapse)'>hide sketch</button></p>

<div id='Table_Resolution' style='display:none'>
<figure class='code'><figcaption><span> (Table_Resolution.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Table_Resolution/Table_Resolution.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing sine tables of different sizes</span>
</span><span class='line'><span class="cm"> *  with Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates the audible quality of different length tables</span>
</span><span class='line'><span class="cm"> *  played with Oscil and scheduling with EventDelay.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin256_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin512_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin1024_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin4096_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt; </span><span class="c1">// for scheduling events</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN256_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN256_DATA</span><span class="p">);</span> <span class="c1">// can hear significant aliasing noise</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN512_DATA</span><span class="p">);</span> <span class="c1">// noise still there but less noticeable</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN1024_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin2</span><span class="p">(</span><span class="n">SIN1024_DATA</span><span class="p">);</span> <span class="c1">// borderline, hardly there if at all</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin3</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// no audible improvement from here on</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN4096_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin4</span><span class="p">(</span><span class="n">SIN4096_DATA</span><span class="p">);</span> <span class="c1">// for 45 year old loud sound damaged ears</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin5</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kWhoseTurnDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">NUM_OSCILS</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gain</span><span class="p">[</span><span class="n">NUM_OSCILS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span> <span class="c1">// gain for each oscil</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">whose_turn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// which oscil to listen to</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Line to sweep frequency at control rate</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">kSweep</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">MILLIS_PER_SWEEP</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">MILLIS_PER_CONTROL</span> <span class="o">=</span> <span class="mi">1000u</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">CONTROL_STEPS_PER_SWEEP</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">MILLIS_PER_SWEEP</span> <span class="o">/</span> <span class="n">MILLIS_PER_CONTROL</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kWhoseTurnDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">MILLIS_PER_SWEEP</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kSweep</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">8192.f</span><span class="p">,</span> <span class="n">CONTROL_STEPS_PER_SWEEP</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kWhoseTurnDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">gain</span><span class="p">[</span><span class="n">whose_turn</span><span class="p">]</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">whose_turn</span> <span class="o">&gt;=</span> <span class="n">NUM_OSCILS</span><span class="p">)</span> <span class="n">whose_turn</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">gain</span><span class="p">[</span><span class="n">whose_turn</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="n">kWhoseTurnDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="n">kSweep</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0UL</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">whose_turn</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">millis</span><span class="p">());</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">float</span> <span class="n">f</span> <span class="o">=</span> <span class="n">kSweep</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="n">whose_turn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span>
</span><span class='line'>    <span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aSin2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aSin3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aSin4</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aSin5</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Vibrato <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Vibrato/Vibrato.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Vibrato/Vibrato.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Vibratoexpand' onclick='javascript:toggleDisplay(Vibrato, Vibratoexpand, Vibratocollapse)'>show sketch</button>
<button id='Vibratocollapse' style='display:none' onclick='javascript:toggleDisplay(Vibrato, Vibratoexpand, Vibratocollapse)'>hide sketch</button></p>

<div id='Vibrato' style='display:none'>
<figure class='code'><figcaption><span> (Vibrato.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Vibrato/Vibrato.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing a sinewave with vibrato,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates simple FM using phase modulation.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt; </span><span class="c1">// for mtof</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aVibrato</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'> <span class="k">const</span> <span class="kt">long</span> <span class="n">intensity</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">84.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aVibrato</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">15.f</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">vibrato</span> <span class="o">=</span> <span class="n">intensity</span> <span class="o">*</span> <span class="n">aVibrato</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">aCos</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">vibrato</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='02.Control'>
02.Control</a></h2>


<hr />

<p>Control_Echo_Theremin <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Echo_Theremin/Control_Echo_Theremin.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Echo_Theremin/Control_Echo_Theremin.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Control_Echo_Thereminexpand' onclick='javascript:toggleDisplay(Control_Echo_Theremin, Control_Echo_Thereminexpand, Control_Echo_Theremincollapse)'>show sketch</button>
<button id='Control_Echo_Theremincollapse' style='display:none' onclick='javascript:toggleDisplay(Control_Echo_Theremin, Control_Echo_Thereminexpand, Control_Echo_Theremincollapse)'>hide sketch</button></p>

<div id='Control_Echo_Theremin' style='display:none'>
<figure class='code'><figcaption><span> (Control_Echo_Theremin.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Control_Echo_Theremin/Control_Echo_Theremin.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a simple light-sensing theremin-like</span>
</span><span class='line'><span class="cm">  instrument with long echoes,</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates ControlDelay() for echoing control values,</span>
</span><span class='line'><span class="cm">  and smoothing an analog input from a sensor</span>
</span><span class='line'><span class="cm">  signal with RecentAverage().</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  The circuit: </span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   * Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">  *  LDR from analog pin to +5V</span>
</span><span class='line'><span class="cm">  *  5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm">  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;RecentAverage.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ControlDelay.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define INPUT_PIN 0 </span><span class="c1">// analog control input</span>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">echo_cells_1</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">echo_cells_2</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">echo_cells_3</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'><span class="n">ControlDelay</span> <span class="o">&lt;</span><span class="mi">128</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">kDelay</span><span class="p">;</span> <span class="c1">// 2seconds</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// oscils to compare bumpy to averaged control input</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin2</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin3</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: RecentAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverage</span><span class="p">;</span> <span class="c1">// how_many_to_average has to be power of 2</span>
</span><span class='line'><span class="kt">int</span> <span class="n">averaged</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">kDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">echo_cells_1</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">bumpy_input</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="n">averaged</span> <span class="o">=</span> <span class="n">kAverage</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">bumpy_input</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">averaged</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">averaged</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aSin2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">echo_cells_2</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aSin3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">echo_cells_3</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">3</span><span class="o">*</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="p">(</span><span class="n">aSin2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="o">+</span><span class="p">(</span><span class="n">aSin3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">))</span> <span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Control_Oscil_Wash <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Oscil_Wash/Control_Oscil_Wash.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Oscil_Wash/Control_Oscil_Wash.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Control_Oscil_Washexpand' onclick='javascript:toggleDisplay(Control_Oscil_Wash, Control_Oscil_Washexpand, Control_Oscil_Washcollapse)'>show sketch</button>
<button id='Control_Oscil_Washcollapse' style='display:none' onclick='javascript:toggleDisplay(Control_Oscil_Wash, Control_Oscil_Washexpand, Control_Oscil_Washcollapse)'>hide sketch</button></p>

<div id='Control_Oscil_Wash' style='display:none'>
<figure class='code'><figcaption><span> (Control_Oscil_Wash.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Control_Oscil_Wash/Control_Oscil_Wash.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Plays a fluctuating ambient wash,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates audio and control rate updates.</span>
</span><span class='line'><span class="cm"> *  There are 8 oscillators updated at control rate to set</span>
</span><span class='line'><span class="cm"> *  the volume of 8 audio oscillators.  Updating the volume</span>
</span><span class='line'><span class="cm"> *  at control rate saves processor time, incrementing the</span>
</span><span class='line'><span class="cm"> *  Oscils only 128 times per second rather than at the</span>
</span><span class='line'><span class="cm"> *  audio rate of 16384 Hz.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// harmonics</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos8</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// volume controls</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol8</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio volumes updated each control interrupt and reused in audio till next control</span>
</span><span class='line'><span class="kt">char</span> <span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">v5</span><span class="p">,</span><span class="n">v6</span><span class="p">,</span><span class="n">v7</span><span class="p">,</span><span class="n">v8</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set harmonic frequencies</span>
</span><span class='line'>  <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">60.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">74.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">64.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">77.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">67.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">81.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos7</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">60.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos8</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">84.f</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// set volume change frequencies</span>
</span><span class='line'>  <span class="n">kVol1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">4.43f</span><span class="p">);</span> <span class="c1">// more of a pulse</span>
</span><span class='line'>  <span class="n">kVol2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.0245f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.019f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.07f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.047f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.031f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol7</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.0717f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol8</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.041f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">v1</span><span class="o">=</span><span class="n">v2</span><span class="o">=</span><span class="n">v3</span><span class="o">=</span><span class="n">v4</span><span class="o">=</span><span class="n">v5</span><span class="o">=</span><span class="n">v6</span><span class="o">=</span><span class="n">v7</span><span class="o">=</span><span class="n">v8</span><span class="o">=</span><span class="mi">127</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>   <span class="n">v1</span> <span class="o">=</span> <span class="n">kVol1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// going at a higher freq, this creates zipper noise, so reduce the gain</span>
</span><span class='line'>   <span class="n">v2</span> <span class="o">=</span> <span class="n">kVol2</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v3</span> <span class="o">=</span> <span class="n">kVol3</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v4</span> <span class="o">=</span> <span class="n">kVol4</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v5</span> <span class="o">=</span> <span class="n">kVol5</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v6</span> <span class="o">=</span> <span class="n">kVol6</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v7</span> <span class="o">=</span> <span class="n">kVol7</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v8</span> <span class="o">=</span> <span class="n">kVol8</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">asig</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span>
</span><span class='line'>    <span class="n">aCos1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v1</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v2</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v3</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos4</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v4</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos5</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v5</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos6</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v6</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos7</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v7</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos8</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v8</span><span class="p">;</span>
</span><span class='line'>  <span class="n">asig</span> <span class="o">&gt;&gt;=</span> <span class="mi">9</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Control_Tremelo <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Tremelo/Control_Tremelo.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Tremelo/Control_Tremelo.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Control_Tremeloexpand' onclick='javascript:toggleDisplay(Control_Tremelo, Control_Tremeloexpand, Control_Tremelocollapse)'>show sketch</button>
<button id='Control_Tremelocollapse' style='display:none' onclick='javascript:toggleDisplay(Control_Tremelo, Control_Tremeloexpand, Control_Tremelocollapse)'>hide sketch</button></p>

<div id='Control_Tremelo' style='display:none'>
<figure class='code'><figcaption><span> (Control_Tremelo.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Control_Tremelo/Control_Tremelo.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of amplitude modulation (as tremelo),</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates audio and control rate updates.</span>
</span><span class='line'><span class="cm"> *  The tremelo oscillator is updated at control rate,</span>
</span><span class='line'><span class="cm"> *  and a Line is used to interpolate the control updates</span>
</span><span class='line'><span class="cm"> *  at audio rate, to remove zipper noise.</span>
</span><span class='line'><span class="cm"> *  A bit contrived and probably less efficient than just </span>
</span><span class='line'><span class="cm"> *  using an audio-rate tremelo oscillator, but hey it&#39;s a demo!</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_valve_2048_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_VALVE_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSig</span><span class="p">(</span><span class="n">TRIANGLE_VALVE_2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="c1">// control oscillator for tremelo</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kTremelo</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="c1">// a line to interpolate control tremolo at audio rate</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">aGain</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aSig</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">65.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kTremelo</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">5.5f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// gain shifted up to give enough range for line&#39;s internal steps</span>
</span><span class='line'>   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gain</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128u</span><span class="o">+</span><span class="n">kTremelo</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'>   <span class="n">aGain</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gain</span><span class="p">,</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(((</span><span class="kt">long</span><span class="p">)</span> <span class="n">aSig</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aGain</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span> <span class="c1">// shifted back to audio range after multiply</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>EventDelay <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/EventDelay/EventDelay.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/EventDelay/EventDelay.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='EventDelayexpand' onclick='javascript:toggleDisplay(EventDelay, EventDelayexpand, EventDelaycollapse)'>show sketch</button>
<button id='EventDelaycollapse' style='display:none' onclick='javascript:toggleDisplay(EventDelay, EventDelayexpand, EventDelaycollapse)'>hide sketch</button></p>

<div id='EventDelay' style='display:none'>
<figure class='code'><figcaption><span> (EventDelay.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/EventDelay/EventDelay.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a sound being toggled on an off,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates scheduling with EventDelay.</span>
</span><span class='line'><span class="cm"> *  EventDelay is a way to make non-blocking</span>
</span><span class='line'><span class="cm"> *  time delays for events.  Use this instead of</span>
</span><span class='line'><span class="cm"> *  the Arduino delay() function, which doesn&#39;t</span>
</span><span class='line'><span class="cm"> *  work with Mozzi.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin8192_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling audio gain changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kGainChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">char</span> <span class="n">gain</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">330</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'>  <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// 1 second countdown, within resolution of CONTROL_RATE</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">gain</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">gain</span><span class="p">;</span> <span class="c1">// flip 0/1</span>
</span><span class='line'>    <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Line_Gliss <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss/Line_Gliss.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss/Line_Gliss.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Line_Glissexpand' onclick='javascript:toggleDisplay(Line_Gliss, Line_Glissexpand, Line_Glisscollapse)'>show sketch</button>
<button id='Line_Glisscollapse' style='display:none' onclick='javascript:toggleDisplay(Line_Gliss, Line_Glissexpand, Line_Glisscollapse)'>hide sketch</button></p>

<div id='Line_Gliss' style='display:none'>
<figure class='code'><figcaption><span> (Line_Gliss.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Line_Gliss/Line_Gliss.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of sliding smoothly</span>
</span><span class='line'><span class="cm"> *  between oscillator frequencies,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates using a Line to efficiently change the</span>
</span><span class='line'><span class="cm"> *  frequency of an oscillator at audio rate.   Calculating</span>
</span><span class='line'><span class="cm"> *  a new frequency for every step of a slide is a lot to</span>
</span><span class='line'><span class="cm"> *  do for every single sample, so instead this sketch works out the </span>
</span><span class='line'><span class="cm"> *  start and end frequencies for each control period and</span>
</span><span class='line'><span class="cm"> *  the phase increments (size of the steps through the sound table)</span>
</span><span class='line'><span class="cm"> *  required for the audio oscillator to generate those frequencies.</span>
</span><span class='line'><span class="cm"> *  Then, a computationally cheap Line() is used to slide between the</span>
</span><span class='line'><span class="cm"> *  different phase increments smoothly at audio rate.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt; </span><span class="c1">// for smooth transitions</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_warm8192_int8.h&gt; </span><span class="c1">// triangle table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">TRIANGLE_WARM8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_WARM8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Line &lt;type&gt; lineName</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aGliss</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">lo_note</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span> <span class="c1">// midi note numbers</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">hi_note</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">long</span> <span class="n">audio_steps_per_gliss</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// ie. 4 glisses per second</span>
</span><span class='line'><span class="kt">long</span> <span class="n">control_steps_per_gliss</span> <span class="o">=</span> <span class="n">CONTROL_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// stuff for changing starting positions, probably just confusing really</span>
</span><span class='line'><span class="kt">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gliss_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">gliss_offset_max</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// start at a new note</span>
</span><span class='line'>    <span class="n">gliss_offset</span> <span class="o">+=</span> <span class="n">gliss_offset_step</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">gliss_offset</span> <span class="o">&gt;=</span> <span class="n">gliss_offset_max</span><span class="p">)</span> <span class="n">gliss_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// only need to calculate frequencies once each control update</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">start_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">lo_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">end_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">hi_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// find the phase increments (step sizes) through the audio table for those freqs</span>
</span><span class='line'>    <span class="c1">// they are big ugly numbers which the oscillator understands but you don&#39;t really want to know</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">gliss_start</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">start_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">gliss_end</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">end_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// set the audio rate line to transition between the different step sizes</span>
</span><span class='line'>    <span class="n">aGliss</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gliss_start</span><span class="p">,</span> <span class="n">gliss_end</span><span class="p">,</span> <span class="n">audio_steps_per_gliss</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">counter</span> <span class="o">=</span> <span class="n">control_steps_per_gliss</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setPhaseInc</span><span class="p">(</span><span class="n">aGliss</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Line_Gliss_Double_32k_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss_Double_32k_HIFI/Line_Gliss_Double_32k_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss_Double_32k_HIFI/Line_Gliss_Double_32k_HIFI.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Line_Gliss_Double_32k_HIFIexpand' onclick='javascript:toggleDisplay(Line_Gliss_Double_32k_HIFI, Line_Gliss_Double_32k_HIFIexpand, Line_Gliss_Double_32k_HIFIcollapse)'>show sketch</button>
<button id='Line_Gliss_Double_32k_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(Line_Gliss_Double_32k_HIFI, Line_Gliss_Double_32k_HIFIexpand, Line_Gliss_Double_32k_HIFIcollapse)'>hide sketch</button></p>

<div id='Line_Gliss_Double_32k_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (Line_Gliss_Double_32k_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Line_Gliss_Double_32k_HIFI/Line_Gliss_Double_32k_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a pair of detuned oscillators </span>
</span><span class='line'><span class="cm"> *  sliding smoothly between frequencies,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates using Lines to efficiently change the</span>
</span><span class='line'><span class="cm"> *  frequency of each oscillator at audio rate.   Calculating</span>
</span><span class='line'><span class="cm"> *  a new frequency for every step of a slide is a lot to</span>
</span><span class='line'><span class="cm"> *  do for every single sample, so instead this sketch works out the </span>
</span><span class='line'><span class="cm"> *  start and end frequencies for each control period and</span>
</span><span class='line'><span class="cm"> *  the phase increments (size of the steps through the sound table)</span>
</span><span class='line'><span class="cm"> *  required for the audio oscillators to generate those frequencies.</span>
</span><span class='line'><span class="cm"> *  Then, computationally cheap Lines are used to slide between the</span>
</span><span class='line'><span class="cm"> *  different phase increments smoothly at audio rate.</span>
</span><span class='line'><span class="cm"> *  Also shows how to use random offsets between the oscillators&#39;</span>
</span><span class='line'><span class="cm"> *  frequencies to produce a chorusing/doubling effect.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm"> *  be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm"> *  In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm"> *  #define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm"> *  //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm"> *  to</span>
</span><span class='line'><span class="cm"> *  //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm"> *  #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Also, AUDIO_RATE can be changed from 16384 to 32768 in mozzi_config.h,</span>
</span><span class='line'><span class="cm"> *  to try out the higher sample rate.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm"> *  Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *                   3.9k </span>
</span><span class='line'><span class="cm"> *   pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm"> *                     1M           |</span>
</span><span class='line'><span class="cm"> *   pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm"> *                                     |</span>
</span><span class='line'><span class="cm"> *                           4.7n  ==</span>
</span><span class='line'><span class="cm"> *                                     |</span>
</span><span class='line'><span class="cm"> *                                 ground</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Resistors are ±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm"> *  from a batch of whatever you can get.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt; </span><span class="c1">// for smooth transitions</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_warm8192_int8.h&gt; </span><span class="c1">// triangle table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">TRIANGLE_WARM8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle1</span><span class="p">(</span><span class="n">TRIANGLE_WARM8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">TRIANGLE_WARM8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle2</span><span class="p">(</span><span class="n">TRIANGLE_WARM8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Line &lt;type&gt; lineName</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aGliss1</span><span class="p">;</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aGliss2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">lo_note</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span> <span class="c1">// midi note numbers</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">hi_note</span> <span class="o">=</span> <span class="mi">46</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">long</span> <span class="n">audio_steps_per_gliss</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// ie. 4 glisses per second</span>
</span><span class='line'><span class="kt">long</span> <span class="n">control_steps_per_gliss</span> <span class="o">=</span> <span class="n">CONTROL_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// stuff for changing starting positions, probably just confusing really</span>
</span><span class='line'><span class="kt">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gliss_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">gliss_offset_max</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span> <span class="c1">// without this, updateControl() gets interrupted ........??</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// optional control rate parameter</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// variation between oscillator&#39;s phase increments</span>
</span><span class='line'><span class="c1">// looks like a big number, but they are high precision </span>
</span><span class='line'><span class="c1">// and this is just like a fractional part</span>
</span><span class='line'><span class="kt">long</span> <span class="n">variation</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">rand</span><span class="p">(</span><span class="mi">16383</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span> <span class="c1">// 900 us floats vs 160 fixed</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// start at a new note</span>
</span><span class='line'>    <span class="n">gliss_offset</span> <span class="o">+=</span> <span class="n">gliss_offset_step</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">gliss_offset</span> <span class="o">&gt;=</span> <span class="n">gliss_offset_max</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">gliss_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// this is just confusing, you should ignore it!</span>
</span><span class='line'>      <span class="c1">// alternate between 2 and 3 steps per start note each time a new &quot;run&quot; starts</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">gliss_offset_step</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">){</span>
</span><span class='line'>        <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// only need to calculate frequencies once each control update</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">start_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">lo_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">end_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">hi_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// find the phase increments (step sizes) through the audio table for those freqs</span>
</span><span class='line'>    <span class="c1">// they are big ugly numbers which the oscillator understands but you don&#39;t really want to know</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">gliss_start</span> <span class="o">=</span> <span class="n">aTriangle1</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">start_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">gliss_end</span> <span class="o">=</span> <span class="n">aTriangle2</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">end_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">aGliss1</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gliss_start</span><span class="p">,</span> <span class="n">gliss_end</span><span class="p">,</span> <span class="n">audio_steps_per_gliss</span><span class="p">);</span>
</span><span class='line'>    <span class="n">aGliss2</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gliss_start</span><span class="o">+</span><span class="p">(</span><span class="n">variation</span><span class="p">()</span><span class="o">*</span><span class="n">gliss_offset</span><span class="p">),</span> <span class="n">gliss_end</span><span class="o">+</span><span class="p">(</span><span class="n">variation</span><span class="p">()</span><span class="o">*</span><span class="n">gliss_offset</span><span class="p">),</span> <span class="n">audio_steps_per_gliss</span><span class="p">);</span>
</span><span class='line'>    <span class="n">counter</span> <span class="o">=</span> <span class="n">control_steps_per_gliss</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aTriangle1</span><span class="p">.</span><span class="n">setPhaseInc</span><span class="p">(</span><span class="n">aGliss1</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aTriangle2</span><span class="p">.</span><span class="n">setPhaseInc</span><span class="p">(</span><span class="n">aGliss2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aTriangle1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="n">aTriangle2</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Pause <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='Pauseexpand' onclick='javascript:toggleDisplay(Pause, Pauseexpand, Pausecollapse)'>show sketch</button>
<button id='Pausecollapse' style='display:none' onclick='javascript:toggleDisplay(Pause, Pauseexpand, Pausecollapse)'>hide sketch</button></p>

<div id='Pause' style='display:none'>
<figure class='code'><figcaption><span> (Pause.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Pause/Pause.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example pausing Mozzi, restoring timers to previous states,</span>
</span><span class='line'><span class="cm"> *  during which Arduino delay() works, then resuming Mozzi again.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  This may be useful when using sensors or other libraries which need to use</span>
</span><span class='line'><span class="cm"> *  the same timers as Mozzi.  (Timer 0, Timer 1, and in HIFI mode, Timer 2).</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/brownnoise8192_int8.h&gt; </span><span class="c1">// recorded audio wavetable</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">BROWNNOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound</span><span class="p">(</span><span class="n">BROWNNOISE8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define STOP_PIN A0</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aCrunchySound</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">setupFastAnalogRead</span><span class="p">();</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="n">STOP_PIN</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">512</span><span class="p">){</span>
</span><span class='line'>    <span class="n">pauseMozzi</span><span class="p">();</span>
</span><span class='line'>    <span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
</span><span class='line'>    <span class="n">unPauseMozzi</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">// jump to a new spot in the noise table to stop it sounding like it repeats</span>
</span><span class='line'>  <span class="n">aCrunchySound</span><span class="p">.</span><span class="n">setPhase</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">BROWNNOISE8192_NUM_CELLS</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aCrunchySound</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>RCpoll <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='RCpollexpand' onclick='javascript:toggleDisplay(RCpoll, RCpollexpand, RCpollcollapse)'>show sketch</button>
<button id='RCpollcollapse' style='display:none' onclick='javascript:toggleDisplay(RCpoll, RCpollexpand, RCpollcollapse)'>hide sketch</button></p>

<div id='RCpoll' style='display:none'>
<figure class='code'><figcaption><span> (RCpoll.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/RCpoll/RCpoll.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Sets the frequency of an oscillator with a resistive sensor on a digital pin,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates RCpoll to read a resistive sensor on a digital pin,</span>
</span><span class='line'><span class="cm"> *  without blocking audio output. </span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Control circuit: http://arduino.cc/en/Tutorial/RCtime</span>
</span><span class='line'><span class="cm"> *  Values for components which work with this sketch are:</span>
</span><span class='line'><span class="cm"> *  Sensing Capacitor .1uf (104)</span>
</span><span class='line'><span class="cm"> *  Variable resistor 1 MegaOhm</span>
</span><span class='line'><span class="cm"> *  Input resistor 470 Ohms</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;RCpoll.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'><span class="cp">#define SENSOR_PIN 4            </span><span class="c1">// digital pin for sensor input</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">RCpoll</span> <span class="o">&lt;</span><span class="n">SENSOR_PIN</span><span class="o">&gt;</span> <span class="n">kNob</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">freq</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="n">kNob</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// kNob ranges about 0 to 13</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// 8 bits scaled up to 14 bits</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='03.Sensors'>
03.Sensors</a></h2>


<hr />

<p>Knob_LDR_x2_WavePacket <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LDR_x2_WavePacket/Knob_LDR_x2_WavePacket.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LDR_x2_WavePacket/Knob_LDR_x2_WavePacket.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Knob_LDR_x2_WavePacketexpand' onclick='javascript:toggleDisplay(Knob_LDR_x2_WavePacket, Knob_LDR_x2_WavePacketexpand, Knob_LDR_x2_WavePacketcollapse)'>show sketch</button>
<button id='Knob_LDR_x2_WavePacketcollapse' style='display:none' onclick='javascript:toggleDisplay(Knob_LDR_x2_WavePacket, Knob_LDR_x2_WavePacketexpand, Knob_LDR_x2_WavePacketcollapse)'>hide sketch</button></p>

<div id='Knob_LDR_x2_WavePacket' style='display:none'>
<figure class='code'><figcaption><span> (Knob_LDR_x2_WavePacket.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Knob_LDR_x2_WavePacket/Knob_LDR_x2_WavePacket.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  </span>
</span><span class='line'><span class="cm">  Example of Wavepacket synthesis, using analog</span>
</span><span class='line'><span class="cm">  inputs to change the fundamental frequency, </span>
</span><span class='line'><span class="cm">  bandwidth and centre frequency,</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates WavePacket, non-blocking analog reads using</span>
</span><span class='line'><span class="cm">  adcReadAllChannels() and adcGetResult(), and smoothing</span>
</span><span class='line'><span class="cm">  control signals with RecentAverage.</span>
</span><span class='line'><span class="cm">  Also demonstrates AutoMap, which maps unpredictable inputs to a set range.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/Mozzi_Introductory_Tutorial.pdf</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    The circuit:</span>
</span><span class='line'><span class="cm">  *  Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  *  Potentiometer connected to analog pin 0.</span>
</span><span class='line'><span class="cm">  *  Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">  *  Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">  * LDR from analog pin to +5V</span>
</span><span class='line'><span class="cm">  * 5.1k resistor from analog pin to ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm">   Light dependent resistor (LDR) and 5.1k resistor on analog pin 2:</span>
</span><span class='line'><span class="cm">  * LDR from analog pin to +5V</span>
</span><span class='line'><span class="cm">  * 5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm">  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">mozzi_analog</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">WavePacket</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">RecentAverage</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">AutoMap</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR1_PIN</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// set the analog input for fm_intensity to pin 1</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR2_PIN</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// set the analog input for mod rate to pin 2</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// min and max values of synth parameters to map AutoRanged analog inputs to</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_F</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_F</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_BW</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_BW</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_CF</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_CF</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// for smoothing the control signals</span>
</span><span class='line'><span class="c1">// use: RecentAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_F</span><span class="p">,</span><span class="n">MAX_F</span><span class="p">);</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapBw</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_BW</span><span class="p">,</span><span class="n">MAX_BW</span><span class="p">);</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapCf</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_CF</span><span class="p">,</span><span class="n">MAX_CF</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">WavePacket</span> <span class="o">&lt;</span><span class="n">DOUBLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// DOUBLE selects 2 overlapping streams</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// set up async analog reading for adcReadAllChannels() and adcGetResult()</span>
</span><span class='line'>  <span class="n">adcEnableInterrupt</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">// request initial read</span>
</span><span class='line'>  <span class="n">adcReadAllChannels</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">// wait before starting Mozzi to receive analog reads, so AutoRange will not get 0</span>
</span><span class='line'>  <span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fundamental</span> <span class="o">=</span> <span class="n">adcGetResult</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fundamental</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">fundamental</span> <span class="o">=</span> <span class="n">kMapF</span><span class="p">(</span><span class="n">fundamental</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fundamental</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">adcGetResult</span><span class="p">(</span><span class="n">LDR1_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">kMapBw</span><span class="p">(</span><span class="n">bandwidth</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">centre_freq</span> <span class="o">=</span> <span class="n">adcGetResult</span><span class="p">(</span><span class="n">LDR2_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="n">centre_freq</span> <span class="o">=</span> <span class="n">kMapCf</span><span class="p">(</span><span class="n">centre_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">fundamental</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">centre_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">adcReadAllChannels</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Knob_LightLevel_FMsynth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_FMsynth/Knob_LightLevel_FMsynth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_FMsynth/Knob_LightLevel_FMsynth.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Knob_LightLevel_FMsynthexpand' onclick='javascript:toggleDisplay(Knob_LightLevel_FMsynth, Knob_LightLevel_FMsynthexpand, Knob_LightLevel_FMsynthcollapse)'>show sketch</button>
<button id='Knob_LightLevel_FMsynthcollapse' style='display:none' onclick='javascript:toggleDisplay(Knob_LightLevel_FMsynth, Knob_LightLevel_FMsynthexpand, Knob_LightLevel_FMsynthcollapse)'>hide sketch</button></p>

<div id='Knob_LightLevel_FMsynth' style='display:none'>
<figure class='code'><figcaption><span> (Knob_LightLevel_FMsynth.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Knob_LightLevel_FMsynth/Knob_LightLevel_FMsynth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/* </span>
</span><span class='line'><span class="cm">  Example using a light dependent resistor (LDR) to change </span>
</span><span class='line'><span class="cm">  an FM synthesis parameter, and a knob for fundamental frequency,</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates analog input, audio oscillators, and phase modulation.</span>
</span><span class='line'><span class="cm">  Also demonstrates AutoMap, which maps unpredictable inputs to a set range.</span>
</span><span class='line'><span class="cm">  There might be clicks in the audio from rapid control changes, which</span>
</span><span class='line'><span class="cm">  could be smoothed with Line or Smooth objects.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/Mozzi_Introductory_Tutorial.pdf</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    The circuit:</span>
</span><span class='line'><span class="cm">  *  Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  *  Potentiometer connected to analog pin 0.</span>
</span><span class='line'><span class="cm">  *  Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">  *  Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">  * LDR from analog pin to +5V</span>
</span><span class='line'><span class="cm">  * 5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm">  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator </span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt; </span><span class="c1">// fast functions for reading analog inputs </span>
</span><span class='line'> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">AutoMap</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span> <span class="c1">// maps unpredictable inputs to a range</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// desired carrier frequency max and min, for AutoMap</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">440</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// desired intensity max and min, for AutoMap, note they&#39;re inverted for reverse dynamics</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_INTENSITY</span> <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_INTENSITY</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_CARRIER_FREQ</span><span class="p">,</span><span class="n">MAX_CARRIER_FREQ</span><span class="p">);</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_INTENSITY</span><span class="p">,</span><span class="n">MAX_INTENSITY</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR_PIN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// set the input for the LDR to analog pin 1</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">mod_ratio</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// harmonics</span>
</span><span class='line'><span class="kt">long</span> <span class="n">fm_intensity</span><span class="p">;</span> <span class="c1">// carries control info from updateControl() to updateAudio()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output for debugging</span>
</span><span class='line'>  <span class="n">setupFastAnalogRead</span><span class="p">();</span> <span class="c1">// speed up analog reads (Mozzi also has other faster ways)</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the knob</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// map the knob to carrier frequency</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="n">knob_value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//calculate the modulation frequency to stay in ratio</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">mod_freq</span> <span class="o">=</span> <span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">mod_ratio</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the FM oscillator frequencies to the calculated values</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the light dependent resistor on the Analog input pin</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">light_level</span><span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">LDR_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;light_level = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">fm_intensity</span> <span class="o">=</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;fm_intensity = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fm_intensity</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// print a carraige return for the next line of debugging info</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">fm_intensity</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">);</span> <span class="c1">// phMod does the FM</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Knob_LightLevel_x2_FMsynth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_x2_FMsynth/Knob_LightLevel_x2_FMsynth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_x2_FMsynth/Knob_LightLevel_x2_FMsynth.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Knob_LightLevel_x2_FMsynthexpand' onclick='javascript:toggleDisplay(Knob_LightLevel_x2_FMsynth, Knob_LightLevel_x2_FMsynthexpand, Knob_LightLevel_x2_FMsynthcollapse)'>show sketch</button>
<button id='Knob_LightLevel_x2_FMsynthcollapse' style='display:none' onclick='javascript:toggleDisplay(Knob_LightLevel_x2_FMsynth, Knob_LightLevel_x2_FMsynthexpand, Knob_LightLevel_x2_FMsynthcollapse)'>hide sketch</button></p>

<div id='Knob_LightLevel_x2_FMsynth' style='display:none'>
<figure class='code'><figcaption><span> (Knob_LightLevel_x2_FMsynth.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Knob_LightLevel_x2_FMsynth/Knob_LightLevel_x2_FMsynth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/* </span>
</span><span class='line'><span class="cm">  Example using 2 light dependent resistors (LDRs) to change </span>
</span><span class='line'><span class="cm">  FM synthesis parameters, and a knob for fundamental frequency,</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates analog input, audio and control oscillators, phase modulation</span>
</span><span class='line'><span class="cm">  and smoothing a control signal at audio rate to avoid clicks.</span>
</span><span class='line'><span class="cm">  Also demonstrates AutoMap, which maps unpredictable inputs to a set range.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/Mozzi_Introductory_Tutorial.pdf</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    The circuit:</span>
</span><span class='line'><span class="cm">  *  Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  *  Potentiometer connected to analog pin 0.</span>
</span><span class='line'><span class="cm">  *  Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">  *  Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">  * LDR from analog pin to +5V</span>
</span><span class='line'><span class="cm">  * 5.1k resistor from analog pin to ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm">   Light dependent resistor (LDR) and 5.1k resistor on analog pin 2:</span>
</span><span class='line'><span class="cm">  * LDR from analog pin to +5V</span>
</span><span class='line'><span class="cm">  * 5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm">  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator </span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt; </span><span class="c1">// fast functions for reading analog inputs </span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;AutoMap.h&gt; </span><span class="c1">// maps unpredictable inputs to a range</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// desired carrier frequency max and min, for AutoMap</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">440</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// desired intensity max and min, for AutoMap, note they&#39;re inverted for reverse dynamics</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_INTENSITY</span> <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_INTENSITY</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// desired mod speed max and min, for AutoMap, note they&#39;re inverted for reverse dynamics</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_MOD_SPEED</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_MOD_SPEED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_CARRIER_FREQ</span><span class="p">,</span><span class="n">MAX_CARRIER_FREQ</span><span class="p">);</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_INTENSITY</span><span class="p">,</span><span class="n">MAX_INTENSITY</span><span class="p">);</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapModSpeed</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_MOD_SPEED</span><span class="p">,</span><span class="n">MAX_MOD_SPEED</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR1_PIN</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// set the analog input for fm_intensity to pin 1</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR2_PIN</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// set the analog input for mod rate to pin 2</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kIntensityMod</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">mod_ratio</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// brightness (harmonics)</span>
</span><span class='line'><span class="kt">long</span> <span class="n">fm_intensity</span><span class="p">;</span> <span class="c1">// carries control info from updateControl to updateAudio</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// smoothing for intensity to remove clicks on transitions</span>
</span><span class='line'><span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.95f</span><span class="p">;</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aSmoothIntensity</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the light level</span>
</span><span class='line'>  <span class="n">setupFastAnalogRead</span><span class="p">();</span> <span class="c1">// speed up analog reads (Mozzi also has other faster ways)</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the knob</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// map the knob to carrier frequency</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="n">knob_value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//calculate the modulation frequency to stay in ratio</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">mod_freq</span> <span class="o">=</span> <span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">mod_ratio</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the FM oscillator frequencies</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the light dependent resistor on the width Analog input pin</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">LDR1_value</span><span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">LDR1_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;LDR1 = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">LDR1_value</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">LDR1_calibrated</span> <span class="o">=</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="n">LDR1_value</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;LDR1_calibrated = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">LDR1_calibrated</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">// calculate the fm_intensity</span>
</span><span class='line'>  <span class="n">fm_intensity</span> <span class="o">=</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">LDR1_calibrated</span> <span class="o">*</span> <span class="p">(</span><span class="n">kIntensityMod</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="mi">128</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back to range after 8 bit multiply</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;fm_intensity = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fm_intensity</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the light dependent resistor on the speed Analog input pin</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">LDR2_value</span><span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">LDR2_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;LDR2 = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">LDR2_value</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// use a float here for low frequencies</span>
</span><span class='line'>  <span class="kt">float</span> <span class="n">mod_speed</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">kMapModSpeed</span><span class="p">(</span><span class="n">LDR2_value</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">;</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;   mod_speed = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">mod_speed</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kIntensityMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mod_speed</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// finally, print a carraige return for the next line of debugging info</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">aSmoothIntensity</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">fm_intensity</span><span class="p">)</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Piezo_Frequency <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Frequency/Piezo_Frequency.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Frequency/Piezo_Frequency.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Piezo_Frequencyexpand' onclick='javascript:toggleDisplay(Piezo_Frequency, Piezo_Frequencyexpand, Piezo_Frequencycollapse)'>show sketch</button>
<button id='Piezo_Frequencycollapse' style='display:none' onclick='javascript:toggleDisplay(Piezo_Frequency, Piezo_Frequencyexpand, Piezo_Frequencycollapse)'>hide sketch</button></p>

<div id='Piezo_Frequency' style='display:none'>
<figure class='code'><figcaption><span> (Piezo_Frequency.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Piezo_Frequency/Piezo_Frequency.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> Example using a piezo to change the frequency of a sinewave</span>
</span><span class='line'><span class="cm"> with Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Demonstrates the use of Oscil to play a wavetable, and analog input for control.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/Mozzi_Introductory_Tutorial.pdf</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> The circuit:</span>
</span><span class='line'><span class="cm"> * Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Piezo on analog pin 3:</span>
</span><span class='line'><span class="cm"> + connection of the piezo attached to the analog pin</span>
</span><span class='line'><span class="cm"> - connection of the piezo attached to ground</span>
</span><span class='line'><span class="cm"> 1-megohm resistor between the analog pin and ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator </span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt; </span><span class="c1">// fast functions for reading analog inputs </span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// increase the rate of updateControl from the default of 64, to catch the piezo&#39;s rapid transients</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">PIEZO_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the piezo </span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values</span>
</span><span class='line'>  <span class="n">setupFastAnalogRead</span><span class="p">();</span> <span class="c1">// speed up analog reads (Mozzi also has other faster ways)</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// :)) use the control rate defined above</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the piezo</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">piezo_value</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">PIEZO_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;piezo_value = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">piezo_value</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s"> </span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints 2 tabs</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">frequency</span> <span class="o">=</span> <span class="n">piezo_value</span><span class="o">*</span><span class="mi">3</span><span class="p">;</span> <span class="c1">// calibrate</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the frequency to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;frequency = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">frequency</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the frequency</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">frequency</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Piezo_SampleScrubber <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleScrubber/Piezo_SampleScrubber.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleScrubber/Piezo_SampleScrubber.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Piezo_SampleScrubberexpand' onclick='javascript:toggleDisplay(Piezo_SampleScrubber, Piezo_SampleScrubberexpand, Piezo_SampleScrubbercollapse)'>show sketch</button>
<button id='Piezo_SampleScrubbercollapse' style='display:none' onclick='javascript:toggleDisplay(Piezo_SampleScrubber, Piezo_SampleScrubberexpand, Piezo_SampleScrubbercollapse)'>hide sketch</button></p>

<div id='Piezo_SampleScrubber' style='display:none'>
<figure class='code'><figcaption><span> (Piezo_SampleScrubber.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Piezo_SampleScrubber/Piezo_SampleScrubber.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">   Example using a piezo to scrub crudely through an audio sample,</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Demonstrates playing a sample at an offset from the beginning,</span>
</span><span class='line'><span class="cm">   and analog input.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">   http://sensorium.github.io/Mozzi/learn/Mozzi_Introductory_Tutorial.pdf</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">   The circuit:</span>
</span><span class='line'><span class="cm">   * Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Piezo on analog pin A3:</span>
</span><span class='line'><span class="cm">   + connection of the piezo attached to the analog pin</span>
</span><span class='line'><span class="cm">   - connection of the piezo attached to ground</span>
</span><span class='line'><span class="cm">   1-megOhm resistor attached from the analog pin to ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">   https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Tim Barrass 2013.</span>
</span><span class='line'><span class="cm">   This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/burroughs1_18649_int8.h&gt; </span><span class="c1">// a converted audio sample included in the Mozzi download</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt; </span><span class="c1">// fast functions for reading analog inputs </span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">PIEZO_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the piezo </span>
</span><span class='line'>
</span><span class='line'><span class="c1">// this is to smooth the piezo signal so the scrub moves relatively smoothly</span>
</span><span class='line'><span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.99f</span><span class="p">;</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmooth</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">burroughs</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values</span>
</span><span class='line'>  <span class="n">setupFastAnalogRead</span><span class="p">();</span> <span class="c1">// speed up analog reads (Mozzi also has other faster ways)</span>
</span><span class='line'>  <span class="n">burroughs</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">);</span> <span class="c1">// play at the speed it was recorded  </span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the piezo</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">piezo_value</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">PIEZO_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;piezo value = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">piezo_value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">start_point</span> <span class="o">=</span> <span class="n">piezo_value</span> <span class="o">*</span><span class="mi">400</span><span class="p">;</span> <span class="c1">// calibrate here</span>
</span><span class='line'>  <span class="n">burroughs</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">kSmooth</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">start_point</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">burroughs</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Piezo_SampleTrigger <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleTrigger/Piezo_SampleTrigger.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleTrigger/Piezo_SampleTrigger.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Piezo_SampleTriggerexpand' onclick='javascript:toggleDisplay(Piezo_SampleTrigger, Piezo_SampleTriggerexpand, Piezo_SampleTriggercollapse)'>show sketch</button>
<button id='Piezo_SampleTriggercollapse' style='display:none' onclick='javascript:toggleDisplay(Piezo_SampleTrigger, Piezo_SampleTriggerexpand, Piezo_SampleTriggercollapse)'>hide sketch</button></p>

<div id='Piezo_SampleTrigger' style='display:none'>
<figure class='code'><figcaption><span> (Piezo_SampleTrigger.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Piezo_SampleTrigger/Piezo_SampleTrigger.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">   Example using a piezo to trigger an audio sample to play,</span>
</span><span class='line'><span class="cm">   and a knob to set the playback pitch,</span>
</span><span class='line'><span class="cm">   with Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Demonstrates one-shot samples and analog input for control.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">   http://sensorium.github.io/Mozzi/learn/Mozzi_Introductory_Tutorial.pdf</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    The circuit:</span>
</span><span class='line'><span class="cm">  *  Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  *  Potentiometer connected to analog pin 0.</span>
</span><span class='line'><span class="cm">  *  Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">  *  Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Piezo on analog pin 3:</span>
</span><span class='line'><span class="cm">   + connection of the piezo attached to the analog pin</span>
</span><span class='line'><span class="cm">   - connection of the piezo attached to ground</span>
</span><span class='line'><span class="cm">   1-megohm resistor between the analog pin and ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">   https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Tim Barrass 2013.</span>
</span><span class='line'><span class="cm">   This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/burroughs1_18649_int8.h&gt; </span><span class="c1">// a converted audio sample included in the Mozzi download</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt; </span><span class="c1">// fast functions for reading analog inputs </span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the knob</span>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">PIEZO_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the piezo </span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>  <span class="c1">// threshold value to decide when the detected signal is a knock or not</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>
</span><span class='line'><span class="kt">float</span> <span class="n">recorded_pitch</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">boolean</span> <span class="n">triggered</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values</span>
</span><span class='line'>  <span class="n">setupFastAnalogRead</span><span class="p">();</span> <span class="c1">// speed up analog reads (Mozzi also has other faster ways)</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the knob</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// 0.1 to double recorded pitch</span>
</span><span class='line'>  <span class="kt">float</span> <span class="n">pitch</span> <span class="o">=</span> <span class="p">(</span><span class="n">recorded_pitch</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">knob_value</span> <span class="o">/</span> <span class="mf">512.f</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1f</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the sample playback frequency</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pitch</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the piezo</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">piezo_value</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">PIEZO_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;piezo value = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">piezo_value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// only trigger once each time the piezo goes over the threshold</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">piezo_value</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">triggered</span><span class="p">){</span>
</span><span class='line'>      <span class="n">aSample</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="n">triggered</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="n">triggered</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Piezo_Switch_Pitch <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Switch_Pitch/Piezo_Switch_Pitch.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Switch_Pitch/Piezo_Switch_Pitch.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Piezo_Switch_Pitchexpand' onclick='javascript:toggleDisplay(Piezo_Switch_Pitch, Piezo_Switch_Pitchexpand, Piezo_Switch_Pitchcollapse)'>show sketch</button>
<button id='Piezo_Switch_Pitchcollapse' style='display:none' onclick='javascript:toggleDisplay(Piezo_Switch_Pitch, Piezo_Switch_Pitchexpand, Piezo_Switch_Pitchcollapse)'>hide sketch</button></p>

<div id='Piezo_Switch_Pitch' style='display:none'>
<figure class='code'><figcaption><span> (Piezo_Switch_Pitch.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Piezo_Switch_Pitch/Piezo_Switch_Pitch.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">   Example using a piezo to trigger an audio sample </span>
</span><span class='line'><span class="cm"> and a switch to change the playback pitch.</span>
</span><span class='line'><span class="cm"> using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Demonstrates one-shot samples, analog input for triggering,</span>
</span><span class='line'><span class="cm"> and digital input for switching.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm"> http://sensorium.github.io/Mozzi/learn/Mozzi_Introductory_Tutorial.pdf</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> The circuit:</span>
</span><span class='line'><span class="cm"> * Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Piezo on analog pin A3:</span>
</span><span class='line'><span class="cm"> + connection of the piezo attached to the analog pin</span>
</span><span class='line'><span class="cm"> - connection of the piezo attached to ground</span>
</span><span class='line'><span class="cm"> 1-megOhm resistor attached from the analog pin to ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Pushbutton on digital pin D4</span>
</span><span class='line'><span class="cm"> *  button from the digital pin to +5V</span>
</span><span class='line'><span class="cm"> * 10K resistor from the digital pin to ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/burroughs1_18649_int8.h&gt; </span><span class="c1">// a converted audio sample included in the Mozzi download</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt; </span><span class="c1">// fast functions for reading analog inputs </span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">PIEZO_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the piezo </span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>  <span class="c1">// threshold value to decide when the detected signal is a knock or not</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">BUTTON_PIN</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="c1">// set the digital input pin for the button</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>
</span><span class='line'><span class="kt">float</span> <span class="n">recorded_pitch</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">char</span> <span class="n">button_state</span><span class="p">,</span> <span class="n">previous_button_state</span><span class="p">;</span> <span class="c1">// variable for reading the pushbutton status       </span>
</span><span class='line'><span class="kt">char</span> <span class="n">latest_button_change</span><span class="p">;</span>
</span><span class='line'><span class="n">boolean</span> <span class="n">triggered</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="kt">float</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">pitch_change</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values</span>
</span><span class='line'>  <span class="n">setupFastAnalogRead</span><span class="p">();</span> <span class="c1">// speed up analog reads (Mozzi also has other faster ways)</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">buttonChangePitch</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the state of the pushbutton value:</span>
</span><span class='line'>  <span class="n">button_state</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">BUTTON_PIN</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// has the button state changed?</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">button_state</span> <span class="o">!=</span> <span class="n">previous_button_state</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// if the latest change was a press, pitch up, else pitch down</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">button_state</span> <span class="o">==</span> <span class="n">HIGH</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">pitch</span> <span class="o">=</span> <span class="mf">2.f</span> <span class="o">*</span><span class="n">recorded_pitch</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">pitch</span> <span class="o">=</span> <span class="mf">0.5f</span> <span class="o">*</span><span class="n">recorded_pitch</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">previous_button_state</span> <span class="o">=</span> <span class="n">button_state</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the piezo</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">piezo_value</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">PIEZO_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;piezo value = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">piezo_value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// only trigger once each time the piezo goes over the threshold</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">piezo_value</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">triggered</span><span class="p">){</span>
</span><span class='line'>      <span class="n">pitch</span> <span class="o">=</span> <span class="n">recorded_pitch</span><span class="p">;</span>
</span><span class='line'>      <span class="n">aSample</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="n">triggered</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="n">triggered</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">buttonChangePitch</span><span class="p">();</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pitch</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Volume_Knob <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob/Volume_Knob.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob/Volume_Knob.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Volume_Knobexpand' onclick='javascript:toggleDisplay(Volume_Knob, Volume_Knobexpand, Volume_Knobcollapse)'>show sketch</button>
<button id='Volume_Knobcollapse' style='display:none' onclick='javascript:toggleDisplay(Volume_Knob, Volume_Knobexpand, Volume_Knobcollapse)'>hide sketch</button></p>

<div id='Volume_Knob' style='display:none'>
<figure class='code'><figcaption><span> (Volume_Knob.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Volume_Knob/Volume_Knob.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  </span>
</span><span class='line'><span class="cm">  Example using a potentiometer to control the amplitude of a sinewave</span>
</span><span class='line'><span class="cm">  with Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates the use of Oscil to play a wavetable, and analog input for control.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/Mozzi_Introductory_Tutorial.pdf</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  The circuit:</span>
</span><span class='line'><span class="cm">  *  Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Potentiometer connected to analog pin 0:</span>
</span><span class='line'><span class="cm">  *  Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">  *  Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> +5V ---|</span>
</span><span class='line'><span class="cm">              /    </span>
</span><span class='line'><span class="cm">  A0 ----\  potentiometer </span>
</span><span class='line'><span class="cm">              /    </span>
</span><span class='line'><span class="cm"> GND ---|</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm">  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">INPUT_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// to convey the volume level from updateControl() to updateAudio()</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">volume</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the input values</span>
</span><span class='line'>  <span class="n">setupFastAnalogRead</span><span class="p">();</span> <span class="c1">// increases the speed of reading the analog input</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the variable resistor for volume</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">sensor_value</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// map it to an 8 bit range for efficient calculations in updateAudio</span>
</span><span class='line'>  <span class="n">volume</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">sensor_value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1023</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;volume = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">volume</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">volume</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back into range after multiplying by 8 bit value</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Volume_Knob_LightLevel_Frequency <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob_LightLevel_Frequency/Volume_Knob_LightLevel_Frequency.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob_LightLevel_Frequency/Volume_Knob_LightLevel_Frequency.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Volume_Knob_LightLevel_Frequencyexpand' onclick='javascript:toggleDisplay(Volume_Knob_LightLevel_Frequency, Volume_Knob_LightLevel_Frequencyexpand, Volume_Knob_LightLevel_Frequencycollapse)'>show sketch</button>
<button id='Volume_Knob_LightLevel_Frequencycollapse' style='display:none' onclick='javascript:toggleDisplay(Volume_Knob_LightLevel_Frequency, Volume_Knob_LightLevel_Frequencyexpand, Volume_Knob_LightLevel_Frequencycollapse)'>hide sketch</button></p>

<div id='Volume_Knob_LightLevel_Frequency' style='display:none'>
<figure class='code'><figcaption><span> (Volume_Knob_LightLevel_Frequency.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Volume_Knob_LightLevel_Frequency/Volume_Knob_LightLevel_Frequency.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  </span>
</span><span class='line'><span class="cm">  Example using a potentiometer to change the amplitude of a sinewave</span>
</span><span class='line'><span class="cm">  and a light dependent resister (LDR) to change the frequency.</span>
</span><span class='line'><span class="cm">  with Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates the use of Oscil to play a wavetable, and analog input for control.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/Mozzi_Introductory_Tutorial.pdf</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  The circuit:</span>
</span><span class='line'><span class="cm">  *  Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Potentiometer connected to analog pin 0:</span>
</span><span class='line'><span class="cm">  *  Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">  *  Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> +5V ---|</span>
</span><span class='line'><span class="cm">              /    </span>
</span><span class='line'><span class="cm">  A0 ----\  potentiometer </span>
</span><span class='line'><span class="cm">              /    </span>
</span><span class='line'><span class="cm"> GND ---|</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">  * LDR from analog pin to +5V</span>
</span><span class='line'><span class="cm">  * 5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm">  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0</span>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">LDR_PIN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// set the input for the LDR to analog pin 1</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">volume</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the analog levels</span>
</span><span class='line'>  <span class="n">setupFastAnalogRead</span><span class="p">();</span> <span class="c1">// increases the speed of reading the analog input</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the potentiometer</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// map it to an 8 bit volume range for efficient calculations in updateAudio</span>
</span><span class='line'>  <span class="n">volume</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">knob_value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1023</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;volume = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">volume</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the light dependent resistor</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">light_level</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">LDR_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;light level = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the frequency</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// cast char output from aSin.next() to int to make room for multiplication</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">volume</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back into range after multiplying by 8 bit value</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='04.Analog_Input'>
04.Analog_Input</a></h2>


<hr />

<p>Audio_Input <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='Audio_Inputexpand' onclick='javascript:toggleDisplay(Audio_Input, Audio_Inputexpand, Audio_Inputcollapse)'>show sketch</button>
<button id='Audio_Inputcollapse' style='display:none' onclick='javascript:toggleDisplay(Audio_Input, Audio_Inputexpand, Audio_Inputcollapse)'>hide sketch</button></p>

<div id='Audio_Input' style='display:none'>
<figure class='code'><figcaption><span> (Audio_Input.ino)</span> <a href='/Mozzi/downloads/code/examples/04.Analog_Input/Audio_Input/Audio_Input.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Test of audio input using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> An audio input using the range between 0 to 5V on analog pin A0</span>
</span><span class='line'><span class="cm"> is sampled and output on digital pin 9.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Configuration: requires &quot;#define USE_AUDIO_INPUT true&quot; to be in</span>
</span><span class='line'><span class="cm"> Mozzi/mozzi_config.h file.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Circuit: </span>
</span><span class='line'><span class="cm"> Audio cable centre wire on pin A0, outer shielding to Arduino Ground.</span>
</span><span class='line'><span class="cm"> Audio output on digital pin 9 (on a Uno or similar), or</span>
</span><span class='line'><span class="cm"> check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">getAudioInput</span><span class="p">();</span> <span class="c1">// range 0-1023</span>
</span><span class='line'>  <span class="n">asig</span> <span class="o">=</span> <span class="n">asig</span> <span class="o">-</span> <span class="mi">512</span><span class="p">;</span> <span class="c1">// now range is -512 to 511</span>
</span><span class='line'>  <span class="c1">// output range in STANDARD mode is -244 to 243, </span>
</span><span class='line'>  <span class="c1">// so you might need to adjust your signal to suit</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Audio_Input_with_Filter_Control <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/04.Analog_Input/Audio_Input_with_Filter_Control/Audio_Input_with_Filter_Control.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/04.Analog_Input/Audio_Input_with_Filter_Control/Audio_Input_with_Filter_Control.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Audio_Input_with_Filter_Controlexpand' onclick='javascript:toggleDisplay(Audio_Input_with_Filter_Control, Audio_Input_with_Filter_Controlexpand, Audio_Input_with_Filter_Controlcollapse)'>show sketch</button>
<button id='Audio_Input_with_Filter_Controlcollapse' style='display:none' onclick='javascript:toggleDisplay(Audio_Input_with_Filter_Control, Audio_Input_with_Filter_Controlexpand, Audio_Input_with_Filter_Controlcollapse)'>hide sketch</button></p>

<div id='Audio_Input_with_Filter_Control' style='display:none'>
<figure class='code'><figcaption><span> (Audio_Input_with_Filter_Control.ino)</span> <a href='/Mozzi/downloads/code/examples/04.Analog_Input/Audio_Input_with_Filter_Control/Audio_Input_with_Filter_Control.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Test of audio input and processing</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Configuration: requires &quot;#define USE_AUDIO_INPUT true&quot; to be in</span>
</span><span class='line'><span class="cm"> *  Mozzi/mozzi_config.h file.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Audio Circuit: Audio input on pin 0, output on digital pin 9 (on a Uno or similar), or</span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Control circuit: http://arduino.cc/en/Tutorial/RCtime</span>
</span><span class='line'><span class="cm"> *  Values for components which work with this sketch are:</span>
</span><span class='line'><span class="cm"> *  Sensing Capacitor .1uf (104)</span>
</span><span class='line'><span class="cm"> *  Variable resistor 1 MegaOhm</span>
</span><span class='line'><span class="cm"> *  Input resistor 470 Ohms</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;LowPassFilter.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;RCpoll.h&gt; </span><span class="c1">// enables </span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'><span class="cp">#define AUDIO_PIN 0              </span><span class="c1">// analog pin for audio input</span>
</span><span class='line'><span class="cp">#define SENSOR_PIN 4            </span><span class="c1">// digital pin for sensor input</span>
</span><span class='line'>
</span><span class='line'><span class="n">LowPassFilter</span> <span class="n">lpf</span><span class="p">;</span>
</span><span class='line'><span class="n">RCpoll</span> <span class="o">&lt;</span><span class="n">SENSOR_PIN</span><span class="o">&gt;</span> <span class="n">kNob</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">AUDIO_PIN</span><span class="p">,</span><span class="n">INPUT</span><span class="p">);</span>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">220</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="n">kNob</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// kNob ranges about 0 to 13</span>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// subtracting 512 moves the unsigned audio data into 0-centred, </span>
</span><span class='line'>  <span class="c1">// signed range required by all Mozzi units</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">getAudioInput</span><span class="p">()</span><span class="o">-</span><span class="mi">512</span><span class="p">;</span>
</span><span class='line'>  <span class="n">asig</span> <span class="o">=</span> <span class="n">lpf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>LowPassFilter_AnalogRead_Control <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/04.Analog_Input/LowPassFilter_AnalogRead_Control/LowPassFilter_AnalogRead_Control.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/04.Analog_Input/LowPassFilter_AnalogRead_Control/LowPassFilter_AnalogRead_Control.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='LowPassFilter_AnalogRead_Controlexpand' onclick='javascript:toggleDisplay(LowPassFilter_AnalogRead_Control, LowPassFilter_AnalogRead_Controlexpand, LowPassFilter_AnalogRead_Controlcollapse)'>show sketch</button>
<button id='LowPassFilter_AnalogRead_Controlcollapse' style='display:none' onclick='javascript:toggleDisplay(LowPassFilter_AnalogRead_Control, LowPassFilter_AnalogRead_Controlexpand, LowPassFilter_AnalogRead_Controlcollapse)'>hide sketch</button></p>

<div id='LowPassFilter_AnalogRead_Control' style='display:none'>
<figure class='code'><figcaption><span> (LowPassFilter_AnalogRead_Control.ino)</span> <a href='/Mozzi/downloads/code/examples/04.Analog_Input/LowPassFilter_AnalogRead_Control/LowPassFilter_AnalogRead_Control.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of filtering a wave, with analog inputs for control,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  This method of reading analog input is now depreciated in Mozzi.</span>
</span><span class='line'><span class="cm"> *  A better way to read analog is to use the asynchronous method</span>
</span><span class='line'><span class="cm"> *  shown in the m_27_adcReadAllChannels_LowPassFilter example.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Still, there may be a situation where this is useful...</span>
</span><span class='line'><span class="cm"> *  Demonstrates LowPassFilter(), fixed point fractional number use,</span>
</span><span class='line'><span class="cm"> *  and Mozzi&#39;s setupFastAnalogRead().  In this example, </span>
</span><span class='line'><span class="cm"> *  setupFastAnalogRead() is enough to prevent</span>
</span><span class='line'><span class="cm"> *  glitching during analogRead().</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi also provides adcStartConversion() and adcGetResult(),</span>
</span><span class='line'><span class="cm"> *  which enable reading analog input one channel at a time without </span>
</span><span class='line'><span class="cm"> *  blocking other processes.  </span>
</span><span class='line'><span class="cm"> *  (Though in most cases the asynchronous adcGetResult() method is probably simpler and better).</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *  3 10k Potentiometers with wipers (middle terminals) </span>
</span><span class='line'><span class="cm"> *  connected to analog pins A2, A3 and A4, and</span>
</span><span class='line'><span class="cm"> *  outside leads to ground and +5V.  </span>
</span><span class='line'><span class="cm"> *  Or your choice of more interesting inputs!</span>
</span><span class='line'><span class="cm"> *  See the Arduino documentation for analogRead().</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/chum9_int8.h&gt; </span><span class="c1">// recorded audio wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// for filter modulation</span>
</span><span class='line'><span class="cp">#include &lt;LowPassFilter.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt; </span><span class="c1">// for fractional modulation frequency</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">CHUM9_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound</span><span class="p">(</span><span class="n">CHUM9_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">LowPassFilter</span> <span class="n">lpf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CENTRE_FREQ_PIN A2</span>
</span><span class='line'><span class="cp">#define MOD_SPEED_PIN A3</span>
</span><span class='line'><span class="cp">#define MOD_WIDTH_PIN A4</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aCrunchySound</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">setupFastAnalogRead</span><span class="p">();</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// change any of the ranges here to suit your inputs, etc.</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">centre_freq</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="n">CENTRE_FREQ_PIN</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// 0 to 255</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Q16n16</span> <span class="n">modulation_speed</span> <span class="o">=</span> <span class="p">((</span><span class="n">Q16n16</span><span class="p">)</span><span class="n">analogRead</span><span class="p">(</span><span class="n">MOD_SPEED_PIN</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// range 0 to 15, Q16n16 fractional</span>
</span><span class='line'>  <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">modulation_speed</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">modulation_width</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="n">MOD_WIDTH_PIN</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// 0 to 63</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">modulation</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="n">kFilterMod</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">modulation_width</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// -32 to 31 </span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// add centre_freq and modulation, and constrain into the filter range (0-255)</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="n">constrain</span><span class="p">(</span><span class="n">centre_freq</span> <span class="o">+</span> <span class="n">modulation</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">240</span><span class="p">);</span>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">lpf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aCrunchySound</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>adcReadAllChannels <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='adcReadAllChannelsexpand' onclick='javascript:toggleDisplay(adcReadAllChannels, adcReadAllChannelsexpand, adcReadAllChannelscollapse)'>show sketch</button>
<button id='adcReadAllChannelscollapse' style='display:none' onclick='javascript:toggleDisplay(adcReadAllChannels, adcReadAllChannelsexpand, adcReadAllChannelscollapse)'>hide sketch</button></p>

<div id='adcReadAllChannels' style='display:none'>
<figure class='code'><figcaption><span> (adcReadAllChannels.ino)</span> <a href='/Mozzi/downloads/code/examples/04.Analog_Input/adcReadAllChannels/adcReadAllChannels.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> *  Example of synchronous analog input,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Demonstrates adcEnableInterrupt(), adcGetResult() and adcReadAllChannels().</span>
</span><span class='line'><span class="cm"> *  adcGetResult() fetches the most recent inputs from an array which</span>
</span><span class='line'><span class="cm"> *  is updated in the background when adcReadAllChannels() is called.</span>
</span><span class='line'><span class="cm"> *  Tested with different combinations of pins on a Nano w/ 328</span>
</span><span class='line'><span class="cm"> *  and etherMega2560.</span>
</span><span class='line'><span class="cm"> *   </span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> *   </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_utils.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">adcEnableInterrupt</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// adcGetResult(n) gets the most recent reading for analog channel n</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// start the next read cycle in the background</span>
</span><span class='line'>  <span class="n">adcReadAllChannels</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>adcReadAllChannels_LowPassFilter <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/04.Analog_Input/adcReadAllChannels_LowPassFilter/adcReadAllChannels_LowPassFilter.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/04.Analog_Input/adcReadAllChannels_LowPassFilter/adcReadAllChannels_LowPassFilter.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='adcReadAllChannels_LowPassFilterexpand' onclick='javascript:toggleDisplay(adcReadAllChannels_LowPassFilter, adcReadAllChannels_LowPassFilterexpand, adcReadAllChannels_LowPassFiltercollapse)'>show sketch</button>
<button id='adcReadAllChannels_LowPassFiltercollapse' style='display:none' onclick='javascript:toggleDisplay(adcReadAllChannels_LowPassFilter, adcReadAllChannels_LowPassFilterexpand, adcReadAllChannels_LowPassFiltercollapse)'>hide sketch</button></p>

<div id='adcReadAllChannels_LowPassFilter' style='display:none'>
<figure class='code'><figcaption><span> (adcReadAllChannels_LowPassFilter.ino)</span> <a href='/Mozzi/downloads/code/examples/04.Analog_Input/adcReadAllChannels_LowPassFilter/adcReadAllChannels_LowPassFilter.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of reading analog inputs to control a filter,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates reading analog inputs asynchronously, so values are</span>
</span><span class='line'><span class="cm"> *  updated in the background while audio generation continues,</span>
</span><span class='line'><span class="cm"> *  and the most recent readings can be read anytime from an array.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *  3 10k Potentiometers with wipers (middle terminals) </span>
</span><span class='line'><span class="cm"> *  connected to analog pins 0, 1 and 2, and</span>
</span><span class='line'><span class="cm"> *  outside leads to ground and +5V.  </span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/chum9_int8.h&gt; </span><span class="c1">// recorded audio wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// for filter modulation</span>
</span><span class='line'><span class="cp">#include &lt;LowPassFilter.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt; </span><span class="c1">// for fractional modulation speed</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">CHUM9_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound</span><span class="p">(</span><span class="n">CHUM9_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">LowPassFilter</span> <span class="n">lpf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Don&#39;t use the Arduino A0, A1 etc pin notation, just say 0, 1, 2...</span>
</span><span class='line'><span class="cp">#define CENTRE_FREQ_ANALOG_IN 0</span>
</span><span class='line'><span class="cp">#define MOD_SPEED_ANALOG_IN 1</span>
</span><span class='line'><span class="cp">#define MOD_WIDTH_ANALOG_IN 2</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aCrunchySound</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">adcEnableInterrupt</span><span class="p">();</span> <span class="c1">// enables the ADC interrupt which gets triggered by adcReadAllChannels()</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">centre_freq</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">CENTRE_FREQ_ANALOG_IN</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// 0 to 255</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Q16n16</span> <span class="n">modulation_speed</span> <span class="o">=</span> <span class="p">((</span><span class="n">Q16n16</span><span class="p">)</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">MOD_SPEED_ANALOG_IN</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// range 0 to 15, Q16n16 fractional</span>
</span><span class='line'>  <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">modulation_speed</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">modulation_width</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">MOD_WIDTH_ANALOG_IN</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// 0 to 63</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">modulation</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="n">kFilterMod</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">modulation_width</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// -32 to 31 </span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// add centre_freq to modulation, and constrain into the filter range (0-255)</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="n">constrain</span><span class="p">(</span><span class="n">centre_freq</span> <span class="o">+</span> <span class="n">modulation</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">adcReadAllChannels</span><span class="p">();</span> <span class="c1">// triggers a series of interrupts to read each channel in the background</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">lpf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aCrunchySound</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>adc_One_at_a_Time <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='adc_One_at_a_Timeexpand' onclick='javascript:toggleDisplay(adc_One_at_a_Time, adc_One_at_a_Timeexpand, adc_One_at_a_Timecollapse)'>show sketch</button>
<button id='adc_One_at_a_Timecollapse' style='display:none' onclick='javascript:toggleDisplay(adc_One_at_a_Time, adc_One_at_a_Timeexpand, adc_One_at_a_Timecollapse)'>hide sketch</button></p>

<div id='adc_One_at_a_Time' style='display:none'>
<figure class='code'><figcaption><span> (adc_One_at_a_Time.ino)</span> <a href='/Mozzi/downloads/code/examples/04.Analog_Input/adc_One_at_a_Time/adc_One_at_a_Time.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> *  Example reading 4 analog inputs and printing the readings,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Demonstrates asynchronous analog input </span>
</span><span class='line'><span class="cm"> *  with adcStartConversion() and adcGetResult(),</span>
</span><span class='line'><span class="cm"> *  using a round-robin scheme in successive updateControl() calls.</span>
</span><span class='line'><span class="cm"> *  adcGetResult() returns the most recent analog conversion.</span>
</span><span class='line'><span class="cm"> *  adcStartConversion(pin) starts the next single conversion</span>
</span><span class='line'><span class="cm"> *   for the selected pin or channel.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  This scheme may be more efficient than using adcReadAllChannels()</span>
</span><span class='line'><span class="cm"> *  since only the required channels are actually converted and any</span>
</span><span class='line'><span class="cm"> *  processing load is distributed across multiple updateControl() calls,</span>
</span><span class='line'><span class="cm"> *  instead of concentrated in a rapid series of interrupts when using</span>
</span><span class='line'><span class="cm"> *  adcReadAllChannels.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">setupFastAnalogRead</span><span class="p">();</span> <span class="c1">// optional</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">NUM_PINS</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">pin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">());</span><span class="c1">// gets the most recent reading</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">++</span><span class="n">pin</span><span class="o">&gt;=</span><span class="n">NUM_PINS</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">pin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">// start the next read cycle in the background</span>
</span><span class='line'>  <span class="n">adcStartConversion</span><span class="p">(</span><span class="n">pin</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='05.Control_Filters'>
05.Control_Filters</a></h2>


<hr />

<p>DCfilter <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='DCfilterexpand' onclick='javascript:toggleDisplay(DCfilter, DCfilterexpand, DCfiltercollapse)'>show sketch</button>
<button id='DCfiltercollapse' style='display:none' onclick='javascript:toggleDisplay(DCfilter, DCfilterexpand, DCfiltercollapse)'>hide sketch</button></p>

<div id='DCfilter' style='display:none'>
<figure class='code'><figcaption><span> (DCfilter.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/DCfilter/DCfilter.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/* Example of filtering an analog input to remove DC bias,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Demonstrates DCfilter(), DC-blocking filter useful for </span>
</span><span class='line'><span class="cm"> *  highlighting changes in control signals.</span>
</span><span class='line'><span class="cm"> *  The output of the filter settles to 0 if the incoming signal stays constant.</span>
</span><span class='line'><span class="cm"> *  If the input changes, the filter output swings to track the change and </span>
</span><span class='line'><span class="cm"> *  eventually settles back to 0.</span>
</span><span class='line'><span class="cm"> *   </span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> *   </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="cp">#include &lt;DCfilter.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">sensorPin</span> <span class="o">=</span> <span class="n">A0</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">sensorValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// variable to store the value coming from the sensor</span>
</span><span class='line'>
</span><span class='line'><span class="n">DCfilter</span> <span class="n">dcFiltered</span><span class="p">(</span><span class="mf">0.9</span><span class="p">);</span> <span class="c1">// parameter sets how long the filter takes to settle</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// read the value from the sensor:</span>
</span><span class='line'>  <span class="n">sensorValue</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">sensorPin</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">sensorValue</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;  Filtered = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">dcFiltered</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">sensorValue</span><span class="p">));</span>
</span><span class='line'>  <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Line_vs_Smooth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Line_vs_Smooth/Line_vs_Smooth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Line_vs_Smooth/Line_vs_Smooth.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Line_vs_Smoothexpand' onclick='javascript:toggleDisplay(Line_vs_Smooth, Line_vs_Smoothexpand, Line_vs_Smoothcollapse)'>show sketch</button>
<button id='Line_vs_Smoothcollapse' style='display:none' onclick='javascript:toggleDisplay(Line_vs_Smooth, Line_vs_Smoothexpand, Line_vs_Smoothcollapse)'>hide sketch</button></p>

<div id='Line_vs_Smooth' style='display:none'>
<figure class='code'><figcaption><span> (Line_vs_Smooth.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/Line_vs_Smooth/Line_vs_Smooth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of 2 different ways to smooth analog inputs,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.  The inputs are used </span>
</span><span class='line'><span class="cm"> *  to control the frequencies of two oscillators.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates how to read analog inputs asynchronously, so values are</span>
</span><span class='line'><span class="cm"> *  updated in the background while audio generation continues,</span>
</span><span class='line'><span class="cm"> *  and the most recent readings can be read anytime from an array.</span>
</span><span class='line'><span class="cm"> *  Also demonstrates linear interpolation with Line(),</span>
</span><span class='line'><span class="cm"> *  filtering with Smooth(), and fixed point numbers.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 </span>
</span><span class='line'><span class="cm"> *  (for standard output on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *  Your choice of analog sesnsors, or</span>
</span><span class='line'><span class="cm"> *  2 10k Potentiometers with wipers (middle terminals) </span>
</span><span class='line'><span class="cm"> *  connected to analog pins 0, 1 and 2, and</span>
</span><span class='line'><span class="cm"> *  outside leads to ground and +5V.  </span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 2 oscillators to compare linear interpolated vs smoothed control</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// Line to interpolate frequency for aSin0.</span>
</span><span class='line'><span class="c1">// Q16n16 is basically (yourNumber &lt;&lt; 16)</span>
</span><span class='line'><span class="c1">// Line needs the small analog input integer values of 0-1023 </span>
</span><span class='line'><span class="c1">// to be scaled up if the time (the number of steps) is big </span>
</span><span class='line'><span class="c1">// enough that distance/time gives a step-size of 0.  </span>
</span><span class='line'><span class="c1">// Then you need floats (which are sometimes too slow and create glitches), </span>
</span><span class='line'><span class="c1">// or fixed point.  Q16n16: ugly but good.</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="n">Q16n16</span><span class="o">&gt;</span> <span class="n">aInterpolate</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// the number of audio steps the line has to take to reach the next control value</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Smoothing unit for aSin1</span>
</span><span class='line'><span class="c1">// This might be better with Q24n8 numbers for more precision, </span>
</span><span class='line'><span class="c1">// but we&#39;ll keep it simpler for the demo.</span>
</span><span class='line'><span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.995f</span><span class="p">;</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">aSmooth</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span> <span class="c1">// to smooth frequency for aSin1</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">660.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">220.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">adcEnableInterrupt</span><span class="p">();</span> <span class="c1">// initialises an efficient way to read analog ins with adcGetResult() and adcReadAllChannels()</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq1</span><span class="p">;</span>  <span class="c1">// global so it can be used in updateAudio, volatile to stop it getting changed while being used</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Q16n16</span> <span class="n">freq0</span> <span class="o">=</span> <span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span> <span class="c1">// 0 to 1023, scaled up to Q16n16 format</span>
</span><span class='line'>  <span class="n">freq1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">adcGetResult</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 0 to 1023</span>
</span><span class='line'>  <span class="n">adcReadAllChannels</span><span class="p">();</span> <span class="c1">// go and collect new analog readings in the background, for next time around</span>
</span><span class='line'>  <span class="n">aInterpolate</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">freq0</span><span class="p">,</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Q16n16</span> <span class="n">interpolatedFreq</span> <span class="o">=</span> <span class="n">aInterpolate</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get the next linear interpolated freq</span>
</span><span class='line'>  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">interpolatedFreq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">smoothedFreq</span> <span class="o">=</span> <span class="n">aSmooth</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">freq1</span><span class="p">);</span> <span class="c1">// get the next filtered frequency</span>
</span><span class='line'>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">smoothedFreq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// &gt;&gt;1 is like /2 but faster (the compiler doesn&#39;t seem to optimise it automatically)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>RecentAverage <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/RecentAverage/RecentAverage.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/RecentAverage/RecentAverage.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='RecentAverageexpand' onclick='javascript:toggleDisplay(RecentAverage, RecentAverageexpand, RecentAveragecollapse)'>show sketch</button>
<button id='RecentAveragecollapse' style='display:none' onclick='javascript:toggleDisplay(RecentAverage, RecentAverageexpand, RecentAveragecollapse)'>hide sketch</button></p>

<div id='RecentAverage' style='display:none'>
<figure class='code'><figcaption><span> (RecentAverage.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/RecentAverage/RecentAverage.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example changing the frequency of 2 sinewaves with 1 analog input,</span>
</span><span class='line'><span class="cm"> *  using RecentAverage() to filter one of the control signals </span>
</span><span class='line'><span class="cm"> *  and the other one unfiltered,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates the difference between a raw control</span>
</span><span class='line'><span class="cm"> *  signal and one smoothed with RecentAverage().</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;RecentAverage.h&gt;</span>
</span><span class='line'>
</span><span class='line'> <span class="err">#</span><span class="n">define</span> <span class="n">INPUT_PIN</span> <span class="mi">0</span> <span class="c1">// analog control input</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">// oscils to compare bumpy to averaged control input</span>
</span><span class='line'> <span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'> <span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">// use: RecentAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverage</span><span class="p">;</span> <span class="c1">// how_many_to_average has to be power of 2</span>
</span><span class='line'><span class="kt">int</span> <span class="n">averaged</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">bumpy_input</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="n">averaged</span> <span class="o">=</span> <span class="n">kAverage</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">bumpy_input</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">bumpy_input</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">averaged</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Smooth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth/Smooth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth/Smooth.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Smoothexpand' onclick='javascript:toggleDisplay(Smooth, Smoothexpand, Smoothcollapse)'>show sketch</button>
<button id='Smoothcollapse' style='display:none' onclick='javascript:toggleDisplay(Smooth, Smoothexpand, Smoothcollapse)'>hide sketch</button></p>

<div id='Smooth' style='display:none'>
<figure class='code'><figcaption><span> (Smooth.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/Smooth/Smooth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a sound changing volume with and without</span>
</span><span class='line'><span class="cm"> *  smoothing of the control signal to remove obvious clicks,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates using Smooth to filter a control signal at audio rate,</span>
</span><span class='line'><span class="cm"> *  EventDelay to schedule changes and rand() to choose random volumes.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  your board check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling audio gain changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kGainChangeDelay</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gainChangeMsec</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//  for scheduling turning smoothing on and off</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kSmoothOnOff</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smoothOnOffMsec</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.9975f</span><span class="p">;</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aSmoothGain</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>
</span><span class='line'><span class="n">boolean</span> <span class="n">smoothIsOn</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="kt">long</span> <span class="n">target_gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">330</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'>  <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gainChangeMsec</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kSmoothOnOff</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">smoothOnOffMsec</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// switch smoothing on and off to show the difference</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kSmoothOnOff</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">smoothIsOn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">aSmoothGain</span><span class="p">.</span><span class="n">setSmoothness</span><span class="p">(</span><span class="mf">0.f</span><span class="p">);</span>
</span><span class='line'>      <span class="n">smoothIsOn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="n">aSmoothGain</span><span class="p">.</span><span class="n">setSmoothness</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>
</span><span class='line'>      <span class="n">smoothIsOn</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">kSmoothOnOff</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// random volume changes</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">target_gain</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="mi">255</span><span class="p">);</span>
</span><span class='line'>    <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">aSmoothGain</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_gain</span><span class="p">)</span> <span class="o">*</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back to char precision after multiply</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Smooth_Frequency <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth_Frequency/Smooth_Frequency.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth_Frequency/Smooth_Frequency.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Smooth_Frequencyexpand' onclick='javascript:toggleDisplay(Smooth_Frequency, Smooth_Frequencyexpand, Smooth_Frequencycollapse)'>show sketch</button>
<button id='Smooth_Frequencycollapse' style='display:none' onclick='javascript:toggleDisplay(Smooth_Frequency, Smooth_Frequencyexpand, Smooth_Frequencycollapse)'>hide sketch</button></p>

<div id='Smooth_Frequency' style='display:none'>
<figure class='code'><figcaption><span> (Smooth_Frequency.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/Smooth_Frequency/Smooth_Frequency.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example sliding between frequencies,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates using Smooth to filter a control signal.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// this is a high value to avoid zipper noise</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 1024 </span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling freq changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kFreqChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothFreq</span><span class="p">(</span><span class="mf">0.975f</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="n">target_freq</span><span class="p">,</span> <span class="n">target_freq1</span><span class="p">,</span> <span class="n">target_freq2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">target_freq1</span> <span class="o">=</span> <span class="mi">441</span><span class="p">;</span>
</span><span class='line'>  <span class="n">target_freq2</span> <span class="o">=</span> <span class="mi">330</span><span class="p">;</span>
</span><span class='line'>  <span class="n">kFreqChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// 1000ms countdown, within resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kFreqChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">target_freq</span> <span class="o">==</span> <span class="n">target_freq1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">target_freq</span> <span class="o">=</span> <span class="n">target_freq2</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="n">target_freq</span> <span class="o">=</span> <span class="n">target_freq1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">kFreqChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">smoothed_freq</span> <span class="o">=</span> <span class="n">kSmoothFreq</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">smoothed_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Teensy_USB_MIDI_portamento <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Teensy_USB_MIDI_portamento/Teensy_USB_MIDI_portamento.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Teensy_USB_MIDI_portamento/Teensy_USB_MIDI_portamento.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Teensy_USB_MIDI_portamentoexpand' onclick='javascript:toggleDisplay(Teensy_USB_MIDI_portamento, Teensy_USB_MIDI_portamentoexpand, Teensy_USB_MIDI_portamentocollapse)'>show sketch</button>
<button id='Teensy_USB_MIDI_portamentocollapse' style='display:none' onclick='javascript:toggleDisplay(Teensy_USB_MIDI_portamento, Teensy_USB_MIDI_portamentoexpand, Teensy_USB_MIDI_portamentocollapse)'>hide sketch</button></p>

<div id='Teensy_USB_MIDI_portamento' style='display:none'>
<figure class='code'><figcaption><span> (Teensy_USB_MIDI_portamento.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/Teensy_USB_MIDI_portamento/Teensy_USB_MIDI_portamento.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a sound being triggered by MIDI input, with portamento.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates playing notes with Mozzi in response to MIDI input.</span>
</span><span class='line'><span class="cm"> *  Also demonstrates Portamento(), a traditional portamento with a </span>
</span><span class='line'><span class="cm"> *  duration which can be set.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Uses the version of the Arduino MIDI library which</span>
</span><span class='line'><span class="cm"> *  works with Teensy boards (http://www.pjrc.com/teensy/td_midi.html).  </span>
</span><span class='line'><span class="cm"> *  Tested on a Teensy2++, which can be used as a MIDI device </span>
</span><span class='line'><span class="cm"> *  without any extra parts.  </span>
</span><span class='line'><span class="cm"> *  The sketch would be almost the same with the mainstream</span>
</span><span class='line'><span class="cm"> *  MIDI library (using MIDI as a prefix to calls instead of usbMIDI).</span>
</span><span class='line'><span class="cm"> *  This sketch won&#39;t compile on the Teensy2++ if you also </span>
</span><span class='line'><span class="cm"> *  have the mainstream MIDI library installed.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: On the Teensy2++, audio output is on pin B5.  Midi input on usb.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MIDI.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt; </span><span class="c1">// for envelope</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ADSR.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Portamento.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio sinewave oscillator</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// envelope generator</span>
</span><span class='line'><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Portamento</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span><span class="n">aPortamento</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define LED 6 </span><span class="c1">// 6 on Teensy++ 2.0, 11 on Teensy 2.0, to see if MIDI is being recieved</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOn</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">aPortamento</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">note</span><span class="p">);</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOff</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOff</span><span class="p">();</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Initiate MIDI communications, listen to all channels (not needed with Teensy usbMIDI)</span>
</span><span class='line'>  <span class="c1">//MIDI.begin(MIDI_CHANNEL_OMNI);    </span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Connect the HandleNoteOn function to the library, so it is called upon reception of a NoteOn.</span>
</span><span class='line'>  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">setHandleNoteOn</span><span class="p">(</span><span class="n">HandleNoteOn</span><span class="p">);</span>  <span class="c1">// Put only the name of the function</span>
</span><span class='line'>  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">setHandleNoteOff</span><span class="p">(</span><span class="n">HandleNoteOff</span><span class="p">);</span>  <span class="c1">// Put only the name of the function</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">300</span><span class="p">);</span> <span class="c1">// 10000 is so the note will sustain 10 seconds unless a noteOff comes</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">aPortamento</span><span class="p">.</span><span class="n">setTime</span><span class="p">(</span><span class="mi">300u</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">aPortamento</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='06.Synthesis'>
06.Synthesis</a></h2>


<hr />

<p>AMsynth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth/AMsynth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth/AMsynth.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='AMsynthexpand' onclick='javascript:toggleDisplay(AMsynth, AMsynthexpand, AMsynthcollapse)'>show sketch</button>
<button id='AMsynthcollapse' style='display:none' onclick='javascript:toggleDisplay(AMsynth, AMsynthexpand, AMsynthcollapse)'>hide sketch</button></p>

<div id='AMsynth' style='display:none'>
<figure class='code'><figcaption><span> (AMsynth.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/AMsynth/AMsynth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of Amplitude Modulation synthesis</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates modulating the gain of one oscillator</span>
</span><span class='line'><span class="cm"> *  by the instantaneous amplitude of another,</span>
</span><span class='line'><span class="cm"> *  shows the use of fixed-point numbers to express fractional</span>
</span><span class='line'><span class="cm"> *  values, random numbers with rand(), and EventDelay()</span>
</span><span class='line'><span class="cm"> *  for scheduling.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/COS2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="c1">//#include &lt;mozzi_utils.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio oscils</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModDepth</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling note changes in updateControl()</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kNoteChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// synthesis parameters in fixed point formats</span>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">ratio</span><span class="p">;</span> <span class="c1">// unsigned int with 8 integer bits and 8 fractional bits</span>
</span><span class='line'><span class="n">Q24n8</span> <span class="n">carrier_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits</span>
</span><span class='line'><span class="n">Q24n8</span> <span class="n">mod_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for random notes</span>
</span><span class='line'><span class="n">Q8n0</span> <span class="n">octave_start_note</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.0f</span><span class="p">);</span>   <span class="c1">// define modulation ratio in float and convert to fixed-point</span>
</span><span class='line'>  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">aModDepth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">13.f</span><span class="p">);</span>     <span class="c1">// vary mod depth to highlight am effects</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">Q16n16</span> <span class="n">last_note</span> <span class="o">=</span> <span class="n">octave_start_note</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change octave now and then</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">last_note</span> <span class="o">=</span> <span class="mi">36</span><span class="o">+</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change step up or down a semitone occasionally</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">13</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change modulation ratio now and then</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">ratio</span> <span class="o">=</span> <span class="p">((</span><span class="n">Q8n8</span><span class="p">)</span> <span class="mi">1</span><span class="o">+</span> <span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">5</span><span class="p">))</span> <span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// sometimes add a fractionto the ratio</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">ratio</span> <span class="o">+=</span> <span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// step up or down 3 semitones (or 0)</span>
</span><span class='line'>    <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">3</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// convert midi to frequency</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">last_note</span><span class="p">);</span>
</span><span class='line'>    <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_to_Q24n8</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// calculate modulation frequency to stay in ratio with carrier</span>
</span><span class='line'>    <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">(</span><span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// (Q24n8 * Q8n8) &gt;&gt; 8 = Q24n8</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// set frequencies of the oscillators</span>
</span><span class='line'>    <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// reset the note scheduler</span>
</span><span class='line'>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">mod</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128u</span><span class="o">+</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">*</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span> <span class="n">aModDepth</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">mod</span> <span class="o">*</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>AMsynth_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth_HIFI/AMsynth_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth_HIFI/AMsynth_HIFI.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='AMsynth_HIFIexpand' onclick='javascript:toggleDisplay(AMsynth_HIFI, AMsynth_HIFIexpand, AMsynth_HIFIcollapse)'>show sketch</button>
<button id='AMsynth_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(AMsynth_HIFI, AMsynth_HIFIexpand, AMsynth_HIFIcollapse)'>hide sketch</button></p>

<div id='AMsynth_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (AMsynth_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/AMsynth_HIFI/AMsynth_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of Amplitude Modulation synthesis</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates modulating the gain of one oscillator</span>
</span><span class='line'><span class="cm"> *  by the instantaneous amplitude of another,</span>
</span><span class='line'><span class="cm"> *  shows the use of fixed-point numbers to express fractional</span>
</span><span class='line'><span class="cm"> *  values, random numbers with rand(), and EventDelay()</span>
</span><span class='line'><span class="cm"> *  for scheduling.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm"> *  be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm"> *  In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm"> *  #define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm"> *  //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm"> *  to</span>
</span><span class='line'><span class="cm"> *  //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm"> *  #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm"> *  Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *                   3.9k </span>
</span><span class='line'><span class="cm"> *   pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm"> *                     1M           |</span>
</span><span class='line'><span class="cm"> *   pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm"> *                                     |</span>
</span><span class='line'><span class="cm"> *                           4.7n  ==</span>
</span><span class='line'><span class="cm"> *                                     |</span>
</span><span class='line'><span class="cm"> *                                 ground</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Resistors are ±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm"> *  from a batch of whatever you can get.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012-13.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/COS2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio oscils</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModDepth</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling note changes in updateControl()</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kNoteChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// synthesis parameters in fixed point formats</span>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">ratio</span><span class="p">;</span> <span class="c1">// unsigned int with 8 integer bits and 8 fractional bits</span>
</span><span class='line'><span class="n">Q24n8</span> <span class="n">carrier_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits</span>
</span><span class='line'><span class="n">Q24n8</span> <span class="n">mod_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for random notes</span>
</span><span class='line'><span class="n">Q8n0</span> <span class="n">octave_start_note</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.0f</span><span class="p">);</span>   <span class="c1">// define modulation ratio in float and convert to fixed-point</span>
</span><span class='line'>  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">aModDepth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">13.f</span><span class="p">);</span>     <span class="c1">// vary mod depth to highlight am effects</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// use default CONTROL_RATE 64</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">Q16n16</span> <span class="n">last_note</span> <span class="o">=</span> <span class="n">octave_start_note</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change octave now and then</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">last_note</span> <span class="o">=</span> <span class="mi">36</span><span class="o">+</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change step up or down a semitone occasionally</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">13</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change modulation ratio now and then</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">ratio</span> <span class="o">=</span> <span class="p">((</span><span class="n">Q8n8</span><span class="p">)</span> <span class="mi">1</span><span class="o">+</span> <span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">5</span><span class="p">))</span> <span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// sometimes add a fraction to the ratio</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">ratio</span> <span class="o">+=</span> <span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// step up or down 3 semitones (or 0)</span>
</span><span class='line'>    <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">3</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// convert midi to frequency</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">last_note</span><span class="p">);</span>
</span><span class='line'>    <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_to_Q24n8</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// calculate modulation frequency to stay in ratio with carrier</span>
</span><span class='line'>    <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">(</span><span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// (Q24n8 * Q8n8) &gt;&gt; 8 = Q24n8</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// set frequencies of the oscillators</span>
</span><span class='line'>    <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// reset the note scheduler</span>
</span><span class='line'>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mod</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128u</span><span class="o">+</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">*</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span> <span class="n">aModDepth</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">out</span> <span class="o">=</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">mod</span> <span class="o">*</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">10</span><span class="p">;</span> <span class="c1">// 16 bit * 8 bit = 24 bit, then &gt;&gt;10 = 14 bit</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Detuned_Beats_Wash <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Detuned_Beats_Wash/Detuned_Beats_Wash.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Detuned_Beats_Wash/Detuned_Beats_Wash.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Detuned_Beats_Washexpand' onclick='javascript:toggleDisplay(Detuned_Beats_Wash, Detuned_Beats_Washexpand, Detuned_Beats_Washcollapse)'>show sketch</button>
<button id='Detuned_Beats_Washcollapse' style='display:none' onclick='javascript:toggleDisplay(Detuned_Beats_Wash, Detuned_Beats_Washexpand, Detuned_Beats_Washcollapse)'>hide sketch</button></p>

<div id='Detuned_Beats_Wash' style='display:none'>
<figure class='code'><figcaption><span> (Detuned_Beats_Wash.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/Detuned_Beats_Wash/Detuned_Beats_Wash.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Plays a fluctuating ambient wash using pairs</span>
</span><span class='line'><span class="cm"> *  of slightly detuned oscillators, following an example</span>
</span><span class='line'><span class="cm"> *  from Miller Puckette&#39;s Pure Data manual.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  The detune frequencies are modified by chance in</span>
</span><span class='line'><span class="cm"> *  updateControl(), and the outputs of 14 audio</span>
</span><span class='line'><span class="cm"> *  oscillators are summed in updateAudio().</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates the use of fixed-point Q16n16</span>
</span><span class='line'><span class="cm"> *  format numbers, mtof() for converting midi note</span>
</span><span class='line'><span class="cm"> *  values to frequency, and xorshift96() for random numbers.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt; </span><span class="c1">// for Q16n16 fixed-point fractional number type</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// harmonics</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// duplicates but slightly off frequency for adding to originals</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos7b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// base pitch frequencies in 24n8 fixed int format (for speed later)</span>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">,</span><span class="n">f4</span><span class="p">,</span><span class="n">f5</span><span class="p">,</span><span class="n">f6</span><span class="p">,</span><span class="n">f7</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">variation</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// 32 random bits &amp; with 524287 (b111 1111 1111 1111 1111)</span>
</span><span class='line'>  <span class="c1">// gives between 0-8 in Q16n16 format</span>
</span><span class='line'>  <span class="k">return</span>  <span class="p">(</span><span class="n">Q16n16</span><span class="p">)</span> <span class="p">(</span><span class="n">xorshift96</span><span class="p">()</span> <span class="o">&amp;</span> <span class="mi">524287UL</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span> <span class="c1">// a literal control rate here</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// select base frequencies using mtof (midi to freq) and fixed-point numbers</span>
</span><span class='line'>  <span class="n">f1</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">48</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f2</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">74</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f3</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">64</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f4</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">77</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f5</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">67</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f6</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">57</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f7</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">60</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set Oscils with chosen frequencies</span>
</span><span class='line'>  <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f3</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f4</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f6</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos7</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f7</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set frequencies of duplicate oscillators</span>
</span><span class='line'>  <span class="n">aCos1b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f1</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos2b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f2</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos3b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f3</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos4b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f4</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos5b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f5</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos6b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f6</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos7b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f7</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// todo: choose a nice scale or progression and make a table for it</span>
</span><span class='line'>  <span class="c1">// or add a very slow gliss for f1-f7, like shephard tones</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// change frequencies of the b oscillators</span>
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="n">lowByte</span><span class="p">(</span><span class="n">xorshift96</span><span class="p">())</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">){</span> <span class="c1">// 7 is 0111</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>      <span class="n">aCos1b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f1</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos2b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f2</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos3b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f3</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos4b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f4</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos5b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f5</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos6b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f6</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos7b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f7</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">aCos1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos1b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos2b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos3b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos4</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos4b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos5</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos5b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos6</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos6b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos7</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos7b</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>FMsynth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth/FMsynth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth/FMsynth.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='FMsynthexpand' onclick='javascript:toggleDisplay(FMsynth, FMsynthexpand, FMsynthcollapse)'>show sketch</button>
<button id='FMsynthcollapse' style='display:none' onclick='javascript:toggleDisplay(FMsynth, FMsynthexpand, FMsynthcollapse)'>hide sketch</button></p>

<div id='FMsynth' style='display:none'>
<figure class='code'><figcaption><span> (FMsynth.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/FMsynth/FMsynth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of simple FM with the phase modulation technique,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates Oscil::phMod() for phase modulation, </span>
</span><span class='line'><span class="cm"> *  Smooth() for smoothing control signals, </span>
</span><span class='line'><span class="cm"> *  and Mozzi&#39;s fixed point number types for fractional frequencies.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Also shows the limitations of Mozzi&#39;s 16384Hz Sample rate,</span>
</span><span class='line'><span class="cm"> *  as aliasing audibly intrudes as the sound gets brighter around </span>
</span><span class='line'><span class="cm"> *  midi note 48.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 256 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModIndex</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// The ratio of deviation to modulation frequency is called the &quot;index of modulation&quot;. ( I = d / Fm )</span>
</span><span class='line'><span class="c1">// It will vary according to the frequency that is modulating the carrier and the amount of deviation.</span>
</span><span class='line'><span class="c1">// so deviation d = I * Fm</span>
</span><span class='line'><span class="c1">// haven&#39;t quite worked this out properly yet...</span>
</span><span class='line'>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">mod_index</span><span class="p">;</span><span class="c1">// = float_to_Q8n8(2.0f); // constant version</span>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">deviation</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">carrier_freq</span><span class="p">,</span> <span class="n">mod_freq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// FM ratio between oscillator frequencies, stays the same through note range</span>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">mod_to_carrier_ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kNoteChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for note changes</span>
</span><span class='line'><span class="n">Q7n8</span> <span class="n">target_note</span><span class="p">,</span> <span class="n">note0</span><span class="p">,</span> <span class="n">note1</span><span class="p">,</span> <span class="n">note_upper_limit</span><span class="p">,</span> <span class="n">note_lower_limit</span><span class="p">,</span> <span class="n">note_change_step</span><span class="p">,</span> <span class="n">smoothed_note</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// using Smooth on midi notes rather than frequency, </span>
</span><span class='line'><span class="c1">// because fractional frequencies need larger types than Smooth can handle</span>
</span><span class='line'><span class="c1">// Inefficient, but...until there is a better Smooth....</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothNote</span><span class="p">(</span><span class="mf">0.95f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">768</span><span class="p">);</span> <span class="c1">// ms countdown, taylored to resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">kModIndex</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.768f</span><span class="p">);</span> <span class="c1">// sync with kNoteChangeDelay</span>
</span><span class='line'>  <span class="n">target_note</span> <span class="o">=</span> <span class="n">note0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note_upper_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note_lower_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note0</span> <span class="o">=</span> <span class="n">note_lower_limit</span><span class="p">;</span>
</span><span class='line'>  <span class="n">note1</span> <span class="o">=</span> <span class="n">note_lower_limit</span> <span class="o">+</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setFreqs</span><span class="p">(</span><span class="n">Q8n8</span> <span class="n">midi_note</span><span class="p">){</span>
</span><span class='line'>  <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q8n8_to_Q16n16</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span> <span class="c1">// convert midi note to fractional frequency</span>
</span><span class='line'>  <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">((</span><span class="n">carrier_freq</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_to_carrier_ratio</span><span class="p">)</span>  <span class="p">;</span> <span class="c1">// (Q16n16&gt;&gt;8) * Q8n8 = Q16n16, beware of overflow</span>
</span><span class='line'>  <span class="n">deviation</span> <span class="o">=</span> <span class="p">((</span><span class="n">mod_freq</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_index</span><span class="p">);</span> <span class="c1">// (Q16n16&gt;&gt;16) * Q8n8 = Q24n8, beware of overflow</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// change note</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">target_note</span><span class="o">==</span><span class="n">note0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">note1</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
</span><span class='line'>      <span class="n">target_note</span><span class="o">=</span><span class="n">note1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="n">note0</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
</span><span class='line'>      <span class="n">target_note</span><span class="o">=</span><span class="n">note0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change direction</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&gt;</span><span class="n">note_upper_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&lt;</span><span class="n">note_lower_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// reset eventdelay</span>
</span><span class='line'>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// vary the modulation index</span>
</span><span class='line'>  <span class="n">mod_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q8n8</span><span class="p">)</span><span class="mi">350</span><span class="o">+</span><span class="n">kModIndex</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// here&#39;s where the smoothing happens</span>
</span><span class='line'>  <span class="n">smoothed_note</span> <span class="o">=</span> <span class="n">kSmoothNote</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_note</span><span class="p">);</span>
</span><span class='line'>  <span class="n">setFreqs</span><span class="p">(</span><span class="n">smoothed_note</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Q15n16</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">deviation</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>FMsynth_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth_HIFI/FMsynth_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth_HIFI/FMsynth_HIFI.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='FMsynth_HIFIexpand' onclick='javascript:toggleDisplay(FMsynth_HIFI, FMsynth_HIFIexpand, FMsynth_HIFIcollapse)'>show sketch</button>
<button id='FMsynth_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(FMsynth_HIFI, FMsynth_HIFIexpand, FMsynth_HIFIcollapse)'>hide sketch</button></p>

<div id='FMsynth_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (FMsynth_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/FMsynth_HIFI/FMsynth_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of simple FM with the phase modulation technique,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates Oscil::phMod() for phase modulation, </span>
</span><span class='line'><span class="cm"> *  Smooth() for smoothing control signals, </span>
</span><span class='line'><span class="cm"> *  and Mozzi&#39;s fixed point number types for fractional frequencies.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm">  *  IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm"> *  be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm"> *  In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm"> *  #define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm"> *  //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm"> *  to</span>
</span><span class='line'><span class="cm"> *  //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm"> *  #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm"> *  Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *                   3.9k </span>
</span><span class='line'><span class="cm"> *   pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm"> *                     1M           |</span>
</span><span class='line'><span class="cm"> *   pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm"> *                                     |</span>
</span><span class='line'><span class="cm"> *                           4.7n  ==</span>
</span><span class='line'><span class="cm"> *                                     |</span>
</span><span class='line'><span class="cm"> *                                 ground</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Resistors are ±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm"> *  from a batch of whatever you can get.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012-13.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 256 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModIndex</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// The ratio of deviation to modulation frequency is called the &quot;index of modulation&quot;. ( I = d / Fm )</span>
</span><span class='line'><span class="c1">// It will vary according to the frequency that is modulating the carrier and the amount of deviation.</span>
</span><span class='line'><span class="c1">// so deviation d = I * Fm</span>
</span><span class='line'><span class="c1">// haven&#39;t quite worked this out properly yet...</span>
</span><span class='line'>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">mod_index</span><span class="p">;</span><span class="c1">// = float_to_Q8n8(2.0f); // constant version</span>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">deviation</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">carrier_freq</span><span class="p">,</span> <span class="n">mod_freq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// FM ratio between oscillator frequencies, stays the same through note range</span>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">mod_to_carrier_ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kNoteChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for note changes</span>
</span><span class='line'><span class="n">Q7n8</span> <span class="n">target_note</span><span class="p">,</span> <span class="n">note0</span><span class="p">,</span> <span class="n">note1</span><span class="p">,</span> <span class="n">note_upper_limit</span><span class="p">,</span> <span class="n">note_lower_limit</span><span class="p">,</span> <span class="n">note_change_step</span><span class="p">,</span> <span class="n">smoothed_note</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// using Smooth on midi notes rather than frequency, </span>
</span><span class='line'><span class="c1">// because fractional frequencies need larger types than Smooth can handle</span>
</span><span class='line'><span class="c1">// Inefficient, but...until there is a better Smooth....</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothNote</span><span class="p">(</span><span class="mf">0.95f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">768</span><span class="p">);</span> <span class="c1">// ms countdown, taylored to resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">kModIndex</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.768f</span><span class="p">);</span> <span class="c1">// sync with kNoteChangeDelay</span>
</span><span class='line'>  <span class="n">target_note</span> <span class="o">=</span> <span class="n">note0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note_upper_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note_lower_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note0</span> <span class="o">=</span> <span class="n">note_lower_limit</span><span class="p">;</span>
</span><span class='line'>  <span class="n">note1</span> <span class="o">=</span> <span class="n">note_lower_limit</span> <span class="o">+</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setFreqs</span><span class="p">(</span><span class="n">Q8n8</span> <span class="n">midi_note</span><span class="p">){</span>
</span><span class='line'>  <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q8n8_to_Q16n16</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span> <span class="c1">// convert midi note to fractional frequency</span>
</span><span class='line'>  <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">((</span><span class="n">carrier_freq</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_to_carrier_ratio</span><span class="p">)</span>  <span class="p">;</span> <span class="c1">// (Q16n16&gt;&gt;8) * Q8n8 = Q16n16, beware of overflow</span>
</span><span class='line'>  <span class="n">deviation</span> <span class="o">=</span> <span class="p">((</span><span class="n">mod_freq</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_index</span><span class="p">);</span> <span class="c1">// (Q16n16&gt;&gt;16) * Q8n8 = Q24n8, beware of overflow</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// change note</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">target_note</span><span class="o">==</span><span class="n">note0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">note1</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
</span><span class='line'>      <span class="n">target_note</span><span class="o">=</span><span class="n">note1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="n">note0</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
</span><span class='line'>      <span class="n">target_note</span><span class="o">=</span><span class="n">note0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change direction</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&gt;</span><span class="n">note_upper_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&lt;</span><span class="n">note_lower_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// reset eventdelay</span>
</span><span class='line'>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// vary the modulation index</span>
</span><span class='line'>  <span class="n">mod_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q8n8</span><span class="p">)</span><span class="mi">350</span><span class="o">+</span><span class="n">kModIndex</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// here&#39;s where the smoothing happens</span>
</span><span class='line'>  <span class="n">smoothed_note</span> <span class="o">=</span> <span class="n">kSmoothNote</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_note</span><span class="p">);</span>
</span><span class='line'>  <span class="n">setFreqs</span><span class="p">(</span><span class="n">smoothed_note</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Q15n16</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">deviation</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="c1">// aCarrier is still only an 8 bit wave so shift up to 14 bits</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>PWM_Phasing <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/PWM_Phasing/PWM_Phasing.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/PWM_Phasing/PWM_Phasing.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='PWM_Phasingexpand' onclick='javascript:toggleDisplay(PWM_Phasing, PWM_Phasingexpand, PWM_Phasingcollapse)'>show sketch</button>
<button id='PWM_Phasingcollapse' style='display:none' onclick='javascript:toggleDisplay(PWM_Phasing, PWM_Phasingexpand, PWM_Phasingcollapse)'>hide sketch</button></p>

<div id='PWM_Phasing' style='display:none'>
<figure class='code'><figcaption><span> (PWM_Phasing.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/PWM_Phasing/PWM_Phasing.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of pulse width modulation,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *   </span>
</span><span class='line'><span class="cm"> *  Based Miller Puckette&#39;s j03.pulse.width.mod example </span>
</span><span class='line'><span class="cm"> *  in the Pure Data documentation, subtracting 2 sawtooth </span>
</span><span class='line'><span class="cm"> *  waves with slightly different tunings to produce a </span>
</span><span class='line'><span class="cm"> *  varying phase difference.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates Phasor().</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Phasor.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Phasor</span> <span class="o">&lt;</span><span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aPhasor1</span><span class="p">;</span>
</span><span class='line'><span class="n">Phasor</span> <span class="o">&lt;</span><span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aPhasor2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="n">freq</span> <span class="o">=</span> <span class="mf">55.f</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aPhasor1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aPhasor2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="mf">0.2f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">aPhasor1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">aPhasor2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">asig1</span><span class="o">-</span><span class="n">asig2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>WavePacket_Double <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Double/WavePacket_Double.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Double/WavePacket_Double.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='WavePacket_Doubleexpand' onclick='javascript:toggleDisplay(WavePacket_Double, WavePacket_Doubleexpand, WavePacket_Doublecollapse)'>show sketch</button>
<button id='WavePacket_Doublecollapse' style='display:none' onclick='javascript:toggleDisplay(WavePacket_Double, WavePacket_Doubleexpand, WavePacket_Doublecollapse)'>hide sketch</button></p>

<div id='WavePacket_Double' style='display:none'>
<figure class='code'><figcaption><span> (WavePacket_Double.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/WavePacket_Double/WavePacket_Double.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of Wavepacket synthesis, using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *  This sketch draws on Miller Puckette&#39;s </span>
</span><span class='line'><span class="cm"> *  Pure Data example, F14.wave.packet.pd, with</span>
</span><span class='line'><span class="cm"> *  two overlapping streams of wave packets.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (for STANDARD mode on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">mozzi_analog</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">WavePacket</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">RecentAverage</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define FUNDAMENTAL_PIN 0</span>
</span><span class='line'><span class="cp">#define BANDWIDTH_PIN 1</span>
</span><span class='line'><span class="cp">#define CENTREFREQ_PIN 2</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for smoothing the control signals</span>
</span><span class='line'><span class="c1">// use: RecentAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">WavePacket</span> <span class="o">&lt;</span><span class="n">DOUBLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// DOUBLE selects 2 overlapping streams</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'>  <span class="n">adcEnableInterrupt</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">kAverageF</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">FUNDAMENTAL_PIN</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="n">kAverageBw</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">BANDWIDTH_PIN</span><span class="p">)),</span>
</span><span class='line'>    <span class="n">kAverageCf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">CENTREFREQ_PIN</span><span class="p">)));</span>
</span><span class='line'>  <span class="n">adcReadAllChannels</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>WavePacket_Sample <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Sample/WavePacket_Sample.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Sample/WavePacket_Sample.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='WavePacket_Sampleexpand' onclick='javascript:toggleDisplay(WavePacket_Sample, WavePacket_Sampleexpand, WavePacket_Samplecollapse)'>show sketch</button>
<button id='WavePacket_Samplecollapse' style='display:none' onclick='javascript:toggleDisplay(WavePacket_Sample, WavePacket_Sampleexpand, WavePacket_Samplecollapse)'>hide sketch</button></p>

<div id='WavePacket_Sample' style='display:none'>
<figure class='code'><figcaption><span> (WavePacket_Sample.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/WavePacket_Sample/WavePacket_Sample.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of Wavepacket synthesis, using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *  This sketch draws on Miller Puckette&#39;s </span>
</span><span class='line'><span class="cm"> *  Pure Data example, F14.wave.packet.pd, with</span>
</span><span class='line'><span class="cm"> *  two overlapping streams of wave packets.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Demonstrates the WavePacketSample object, which enables a</span>
</span><span class='line'><span class="cm"> *  custom sound table to be used as the audio source for wavepackets.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (for STANDARD mode on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;WavePacketSample.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;RecentAverage.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;samples/raven_arh_int8.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define FUNDAMENTAL_PIN 0</span>
</span><span class='line'><span class="cp">#define BANDWIDTH_PIN 1</span>
</span><span class='line'><span class="cp">#define CENTREFREQ_PIN 2</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for smoothing the control signals</span>
</span><span class='line'><span class="c1">// use: RecentAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">WavePacketSample</span> <span class="o">&lt;</span><span class="n">DOUBLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// DOUBLE selects 2 overlapping streams</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">wavey</span><span class="p">.</span><span class="n">setTable</span><span class="p">(</span><span class="n">RAVEN_ARH_DATA</span><span class="p">);</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'>  <span class="n">adcEnableInterrupt</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="n">kAverageF</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">FUNDAMENTAL_PIN</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">kAverageBw</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">BANDWIDTH_PIN</span><span class="p">));</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">cf</span> <span class="o">=</span> <span class="n">kAverageCf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">CENTREFREQ_PIN</span><span class="p">));</span>
</span><span class='line'>  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">cf</span><span class="p">);</span>
</span><span class='line'>  <span class="n">adcReadAllChannels</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>WavePacket_Single <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Single/WavePacket_Single.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Single/WavePacket_Single.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='WavePacket_Singleexpand' onclick='javascript:toggleDisplay(WavePacket_Single, WavePacket_Singleexpand, WavePacket_Singlecollapse)'>show sketch</button>
<button id='WavePacket_Singlecollapse' style='display:none' onclick='javascript:toggleDisplay(WavePacket_Single, WavePacket_Singleexpand, WavePacket_Singlecollapse)'>hide sketch</button></p>

<div id='WavePacket_Single' style='display:none'>
<figure class='code'><figcaption><span> (WavePacket_Single.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/WavePacket_Single/WavePacket_Single.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of Wavepacket synthesis, using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *  This sketch draws on Miller Puckette&#39;s </span>
</span><span class='line'><span class="cm"> *  Pure Data example, F14.wave.packet.pd, with</span>
</span><span class='line'><span class="cm"> *  one non-overlapping stream of wave packets.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (for STANDARD mode on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">mozzi_analog</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">WavePacket</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">RecentAverage</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define FUNDAMENTAL_PIN 0</span>
</span><span class='line'><span class="cp">#define BANDWIDTH_PIN 1</span>
</span><span class='line'><span class="cp">#define CENTREFREQ_PIN 2</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for smoothing the control signals</span>
</span><span class='line'><span class="c1">// use: RecentAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
</span><span class='line'><span class="n">RecentAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">WavePacket</span> <span class="o">&lt;</span><span class="n">SINGLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// SINGLE selects 1 non-overlapping stream</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'>  <span class="n">adcEnableInterrupt</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">kAverageF</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">FUNDAMENTAL_PIN</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="n">kAverageBw</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">BANDWIDTH_PIN</span><span class="p">)),</span>
</span><span class='line'>    <span class="n">kAverageCf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">adcGetResult</span><span class="p">(</span><span class="n">CENTREFREQ_PIN</span><span class="p">)));</span>
</span><span class='line'>  <span class="n">adcReadAllChannels</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Waveshaper <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper/Waveshaper.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper/Waveshaper.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Waveshaperexpand' onclick='javascript:toggleDisplay(Waveshaper, Waveshaperexpand, Waveshapercollapse)'>show sketch</button>
<button id='Waveshapercollapse' style='display:none' onclick='javascript:toggleDisplay(Waveshaper, Waveshaperexpand, Waveshapercollapse)'>hide sketch</button></p>

<div id='Waveshaper' style='display:none'>
<figure class='code'><figcaption><span> (Waveshaper.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/Waveshaper/Waveshaper.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example using waveshaping to modify the spectrum of an audio signal</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates the use of WaveShaper(), EventDelay(), Smooth(),</span>
</span><span class='line'><span class="cm"> *  rand(), and fixed-point numbers.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;WaveShaper.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/waveshape_chebyshev_3rd_256_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/waveshape_chebyshev_6th_256_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/waveshape_compress_512_to_488_int16.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// sine wave sound source</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aGain1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// to fade sine wave in and out before waveshaping</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aGain2</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// to fade sine wave in and out before waveshaping</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Chebyshev polynomial curves, The nth curve produces the n+2th harmonic component.</span>
</span><span class='line'><span class="n">WaveShaper</span> <span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">aCheby3rd</span><span class="p">(</span><span class="n">CHEBYSHEV_3RD_256_DATA</span><span class="p">);</span> <span class="c1">// 5th harmonic</span>
</span><span class='line'><span class="n">WaveShaper</span> <span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">aCheby6th</span><span class="p">(</span><span class="n">CHEBYSHEV_6TH_256_DATA</span><span class="p">);</span> <span class="c1">// 8th harmonic</span>
</span><span class='line'><span class="n">WaveShaper</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">aCompress</span><span class="p">(</span><span class="n">WAVESHAPE_COMPRESS_512_TO_488_DATA</span><span class="p">);</span> <span class="c1">// to compress instead of dividing by 2 after adding signals</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling note changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kChangeNoteDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for random notes</span>
</span><span class='line'><span class="n">Q8n0</span> <span class="n">octave_start_note</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'><span class="n">Q24n8</span> <span class="n">carrier_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// smooth transitions between notes</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothFreq</span><span class="p">(</span><span class="mf">0.85f</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="n">target_freq</span><span class="p">,</span> <span class="n">smoothed_freq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">110</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'>  <span class="n">aGain1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.f</span><span class="p">);</span> <span class="c1">// use a float for low frequencies, in setup it doesn&#39;t need to be fast</span>
</span><span class='line'>  <span class="n">aGain2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.4f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">rndPentatonic</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">note</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span><span class="n">note</span><span class="p">){</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>    <span class="n">note</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>    <span class="n">note</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>    <span class="n">note</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>    <span class="n">note</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>    <span class="n">note</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">note</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span> <span class="c1">// about 1 in 5 or so</span>
</span><span class='line'>      <span class="c1">// change octave to midi 24 or any of 3 octaves above</span>
</span><span class='line'>      <span class="n">octave_start_note</span> <span class="o">=</span> <span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="mi">36</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">octave_start_note</span><span class="o">+</span><span class="n">rndPentatonic</span><span class="p">());</span>
</span><span class='line'>    <span class="n">target_freq</span> <span class="o">=</span> <span class="n">Q16n16_to_Q16n0</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span> <span class="c1">// has to be 16 bits for Smooth</span>
</span><span class='line'>    <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">smoothed_freq</span> <span class="o">=</span> <span class="n">kSmoothFreq</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_freq</span><span class="o">*</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// temporarily scale up target_freq to get better int smoothing at low values</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">smoothed_freq</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// then scale it back down after it&#39;s smoothed</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig0</span> <span class="o">=</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// sine wave source</span>
</span><span class='line'>  <span class="c1">// make 2 signals fading in and out to show effect of amplitude when waveshaping with Chebyshev polynomial curves</span>
</span><span class='line'>  <span class="c1">// offset the signals by 128 to fit in the 0-255 range for the waveshaping table lookups</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">asig1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="p">((</span><span class="n">asig0</span><span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="n">aGain1</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">asig2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="p">((</span><span class="n">asig0</span><span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="n">aGain2</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// get the waveshaped signals</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">awaveshaped1</span> <span class="o">=</span> <span class="n">aCheby3rd</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig1</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">awaveshaped2</span> <span class="o">=</span> <span class="n">aCheby6th</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig2</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// use a waveshaping table to squeeze 2 summed 8 bit signals into the range -244 to 243</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">awaveshaped3</span> <span class="o">=</span> <span class="n">aCompress</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">256u</span> <span class="o">+</span> <span class="n">awaveshaped1</span> <span class="o">+</span> <span class="n">awaveshaped2</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">awaveshaped3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Waveshaper_Difference_Tone <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper_Difference_Tone/Waveshaper_Difference_Tone.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper_Difference_Tone/Waveshaper_Difference_Tone.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Waveshaper_Difference_Toneexpand' onclick='javascript:toggleDisplay(Waveshaper_Difference_Tone, Waveshaper_Difference_Toneexpand, Waveshaper_Difference_Tonecollapse)'>show sketch</button>
<button id='Waveshaper_Difference_Tonecollapse' style='display:none' onclick='javascript:toggleDisplay(Waveshaper_Difference_Tone, Waveshaper_Difference_Toneexpand, Waveshaper_Difference_Tonecollapse)'>hide sketch</button></p>

<div id='Waveshaper_Difference_Tone' style='display:none'>
<figure class='code'><figcaption><span> (Waveshaper_Difference_Tone.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/Waveshaper_Difference_Tone/Waveshaper_Difference_Tone.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example using waveshaping to modify the spectrum of an audio signal</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates the use of WaveShaper(), EventDelay(), Smooth(),</span>
</span><span class='line'><span class="cm"> *  rand(), and fixed-point numbers.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;WaveShaper.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/waveshape_chebyshev_3rd_256_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/waveshape_chebyshev_6th_256_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/waveshape_compress_512_to_488_int16.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// sine wave sound source</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin2</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// sine wave sound source</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aGain</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// to fade audio signal in and out before waveshaping</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling note changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kChangeNoteDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio frequency as Q16n16 fractional number</span>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">freq1</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// smooth transitions between notes</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothFreq</span><span class="p">(</span><span class="mf">0.85f</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="n">target_freq</span><span class="p">,</span> <span class="n">smoothed_freq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)</span>
</span><span class='line'>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">freq1</span><span class="p">);</span> <span class="c1">// set the frequency with a Q16n16 fractional number</span>
</span><span class='line'>  <span class="n">aGain</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.2f</span><span class="p">);</span> <span class="c1">// use a float for low frequencies, in setup it doesn&#39;t need to be fast</span>
</span><span class='line'>  <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="c1">// change proportional frequency of second tone</span>
</span><span class='line'>    <span class="n">byte</span> <span class="n">harmonic</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">12</span><span class="p">);</span>
</span><span class='line'>    <span class="n">byte</span> <span class="n">shimmer</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">harmonic_step</span> <span class="o">=</span> <span class="n">freq1</span><span class="o">/</span><span class="mi">12</span><span class="p">;</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">freq2difference</span> <span class="o">=</span> <span class="n">harmonic</span><span class="o">*</span><span class="n">harmonic_step</span><span class="p">;</span>
</span><span class='line'>    <span class="n">freq2difference</span> <span class="o">+=</span> <span class="p">(</span><span class="n">harmonic_step</span><span class="o">*</span><span class="n">shimmer</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">11</span><span class="p">;</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">freq2</span> <span class="o">=</span> <span class="n">freq1</span><span class="o">-</span><span class="n">freq2difference</span><span class="p">;</span>
</span><span class='line'>    <span class="n">aSin2</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">freq2</span><span class="p">);</span> <span class="c1">// set the frequency with a Q16n16 fractional number</span>
</span><span class='line'>    <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((((</span><span class="kt">long</span><span class="p">)</span><span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span> <span class="n">aSin2</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="mi">200u</span><span class="o">+</span><span class="n">aGain</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">clipped</span> <span class="o">=</span> <span class="n">constrain</span><span class="p">(</span><span class="n">asig</span><span class="p">,</span><span class="o">-</span><span class="mi">244</span><span class="p">,</span><span class="mi">243</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">clipped</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='07.Envelopes'>
07.Envelopes</a></h2>


<hr />

<p>ADSR_Envelope <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Envelope/ADSR_Envelope.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Envelope/ADSR_Envelope.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='ADSR_Envelopeexpand' onclick='javascript:toggleDisplay(ADSR_Envelope, ADSR_Envelopeexpand, ADSR_Envelopecollapse)'>show sketch</button>
<button id='ADSR_Envelopecollapse' style='display:none' onclick='javascript:toggleDisplay(ADSR_Envelope, ADSR_Envelopeexpand, ADSR_Envelopecollapse)'>hide sketch</button></p>

<div id='ADSR_Envelope' style='display:none'>
<figure class='code'><figcaption><span> (ADSR_Envelope.ino)</span> <a href='/Mozzi/downloads/code/examples/07.Envelopes/ADSR_Envelope/ADSR_Envelope.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example applying an ADSR envelope to an audio signal</span>
</span><span class='line'><span class="cm"> *  with Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates a simple ADSR object being controlled with</span>
</span><span class='line'><span class="cm"> *  noteOn() and noteOff() instructions.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Created by Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ADSR.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin512_int8.h&gt; </span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">512</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil</span><span class="p">(</span><span class="n">SIN512_DATA</span><span class="p">);;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for triggering the envelope</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">boringDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">boolean</span> <span class="n">note_is_on</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">boringDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="c1">// 2 second countdown</span>
</span><span class='line'>  <span class="n">aOscil</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">440.f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set attack and decay levels</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Set a long sustain time if you intend to finish the note on the fly with noteOff().</span>
</span><span class='line'>  <span class="c1">// You can also provide a sustain time if you want it to finish in its own time without a noteOff().</span>
</span><span class='line'>  <span class="c1">// make sure the release time is long enough in relation to CONTROL_RATE for a few control steps</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="mi">200u</span><span class="p">,</span><span class="mi">300u</span><span class="p">,</span><span class="mi">10000u</span><span class="p">,</span><span class="mi">500u</span><span class="p">);</span>  <span class="c1">// &quot;u&quot; means unsigned int</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">boringDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">note_is_on</span><span class="p">){</span>
</span><span class='line'>      <span class="n">note_is_on</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="n">envelope</span><span class="p">.</span><span class="n">noteOff</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="n">note_is_on</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>      <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">boringDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aOscil</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Ead_Envelope <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Ead_Envelope/Ead_Envelope.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Ead_Envelope/Ead_Envelope.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Ead_Envelopeexpand' onclick='javascript:toggleDisplay(Ead_Envelope, Ead_Envelopeexpand, Ead_Envelopecollapse)'>show sketch</button>
<button id='Ead_Envelopecollapse' style='display:none' onclick='javascript:toggleDisplay(Ead_Envelope, Ead_Envelopeexpand, Ead_Envelopecollapse)'>hide sketch</button></p>

<div id='Ead_Envelope' style='display:none'>
<figure class='code'><figcaption><span> (Ead_Envelope.ino)</span> <a href='/Mozzi/downloads/code/examples/07.Envelopes/Ead_Envelope/Ead_Envelope.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing an enveloped noise source</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates Ead (exponential attack decay).</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/whitenoise8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Ead.h&gt; </span><span class="c1">// exponential attack decay</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 256 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">WHITENOISE8192_DATA</span><span class="p">);</span> <span class="c1">// audio noise</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kDelay</span><span class="p">;</span> <span class="c1">// for triggering envelope start</span>
</span><span class='line'><span class="n">Ead</span> <span class="n">kEnvelope</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// resolution will be CONTROL_RATE</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">gain</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs</span>
</span><span class='line'>  <span class="c1">// use float to set freq because it will be small and fractional</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">AUDIO_RATE</span><span class="o">/</span><span class="n">WHITENOISE8192_SAMPLERATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// jump around in audio noise table to disrupt obvious looping</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setPhase</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">uint</span><span class="p">)</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="c1">// set random parameters</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">500u</span><span class="p">)</span><span class="o">+</span><span class="mi">200</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">75</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">decay</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">-</span> <span class="n">attack</span><span class="p">;</span>
</span><span class='line'>    <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">);</span>
</span><span class='line'>    <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">duration</span><span class="o">+</span><span class="mi">500</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">gain</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">kEnvelope</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">gain</span><span class="o">*</span><span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Phasemod_Envelope <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Phasemod_Envelope/Phasemod_Envelope.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Phasemod_Envelope/Phasemod_Envelope.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Phasemod_Envelopeexpand' onclick='javascript:toggleDisplay(Phasemod_Envelope, Phasemod_Envelopeexpand, Phasemod_Envelopecollapse)'>show sketch</button>
<button id='Phasemod_Envelopecollapse' style='display:none' onclick='javascript:toggleDisplay(Phasemod_Envelope, Phasemod_Envelopeexpand, Phasemod_Envelopecollapse)'>hide sketch</button></p>

<div id='Phasemod_Envelope' style='display:none'>
<figure class='code'><figcaption><span> (Phasemod_Envelope.ino)</span> <a href='/Mozzi/downloads/code/examples/07.Envelopes/Phasemod_Envelope/Phasemod_Envelope.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a modulating timbre with a rhythmic</span>
</span><span class='line'><span class="cm"> *  volume envelope, using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates phase modulation and modifying</span>
</span><span class='line'><span class="cm"> *  the volume of a sound with an envelope setd in a table.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/envelop2048_uint8.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 512 </span><span class="c1">// quite fast, keeps modulation smooth</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModWidth</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">ENVELOP2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aEnvelop</span><span class="p">(</span><span class="n">ENVELOP2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">220</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kModFreq1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.78f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kModFreq2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.1757f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModWidth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.1434f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aEnvelop</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">9.0f</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">277.0f</span> <span class="o">+</span> <span class="mf">0.4313f</span><span class="o">*</span><span class="n">kModFreq1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">kModFreq2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">260u</span><span class="o">+</span><span class="n">aModWidth</span><span class="p">.</span><span class="n">next</span><span class="p">()));</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">asig</span><span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">aEnvelop</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='08.Samples'>
08.Samples</a></h2>


<hr />

<p>Sample <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample/Sample.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample/Sample.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Sampleexpand' onclick='javascript:toggleDisplay(Sample, Sampleexpand, Samplecollapse)'>show sketch</button>
<button id='Samplecollapse' style='display:none' onclick='javascript:toggleDisplay(Sample, Sampleexpand, Samplecollapse)'>hide sketch</button></p>

<div id='Sample' style='display:none'>
<figure class='code'><figcaption><span> (Sample.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Sample/Sample.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of playing a sampled sound,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates one-shot samples scheduled</span>
</span><span class='line'><span class="cm"> *  with EventDelay.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/burroughs1_18649_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling sample start</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kTriggerDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">);</span> <span class="c1">// play at the speed it was recorded</span>
</span><span class='line'>  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span> <span class="c1">// 1500 msec countdown, within resolution of CONTROL_RATE</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">aSample</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Sample_Loop_Points <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Loop_Points/Sample_Loop_Points.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Loop_Points/Sample_Loop_Points.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Sample_Loop_Pointsexpand' onclick='javascript:toggleDisplay(Sample_Loop_Points, Sample_Loop_Pointsexpand, Sample_Loop_Pointscollapse)'>show sketch</button>
<button id='Sample_Loop_Pointscollapse' style='display:none' onclick='javascript:toggleDisplay(Sample_Loop_Points, Sample_Loop_Pointsexpand, Sample_Loop_Pointscollapse)'>hide sketch</button></p>

<div id='Sample_Loop_Points' style='display:none'>
<figure class='code'><figcaption><span> (Sample_Loop_Points.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Sample_Loop_Points/Sample_Loop_Points.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing a looped sampled sound while </span>
</span><span class='line'><span class="cm"> *  changing the start end end loop points, </span>
</span><span class='line'><span class="cm"> *  and sliding the frequency around,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates Sample(), looping with random </span>
</span><span class='line'><span class="cm"> *  changes to loop and frequency parameters</span>
</span><span class='line'><span class="cm"> *  scheduled with EventDelay.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/abomb16384_int8.h&gt; </span><span class="c1">// table for Sample</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">ABOMB_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">ABOMB_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kTriggerDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">float</span> <span class="n">playspeed</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">;</span>
</span><span class='line'><span class="kt">float</span> <span class="n">playspeedmod</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="kt">float</span> <span class="n">speedchange</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">full</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mf">1000.f</span><span class="o">/</span><span class="n">playspeed</span><span class="p">)</span> <span class="o">-</span> <span class="mi">23</span><span class="p">;</span> <span class="c1">// adjustment approx for CONTROL_RATE difference</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">playspeed</span><span class="o">*</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">ABOMB_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">ABOMB_NUM_CELLS</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">full</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setLoopingOn</span><span class="p">();</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">chooseStart</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">ABOMB_NUM_CELLS</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">chooseEnd</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">startpos</span><span class="p">){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">rand</span><span class="p">(</span><span class="n">startpos</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">ABOMB_NUM_CELLS</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">chooseSpeedMod</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>    <span class="n">speedchange</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="o">-</span><span class="mi">100</span><span class="p">,(</span><span class="kt">char</span><span class="p">)</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">8000</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">startspeed</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="o">-</span><span class="mi">100</span><span class="p">,(</span><span class="kt">char</span><span class="p">)</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">;</span>
</span><span class='line'>    <span class="n">playspeedmod</span> <span class="o">=</span> <span class="n">playspeed</span> <span class="o">+</span> <span class="n">startspeed</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="n">speedchange</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">playspeedmod</span> <span class="o">=</span> <span class="n">playspeed</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">chooseStartEnd</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>    <span class="n">s</span> <span class="o">=</span> <span class="n">chooseStart</span><span class="p">();</span>
</span><span class='line'>    <span class="n">e</span> <span class="o">=</span> <span class="n">chooseEnd</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">e</span> <span class="o">=</span> <span class="n">ABOMB_NUM_CELLS</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setStart</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setEnd</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">chooseStartEnd</span><span class="p">();</span>
</span><span class='line'>    <span class="n">chooseSpeedMod</span><span class="p">();</span>
</span><span class='line'>    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">playspeedmod</span> <span class="o">+=</span> <span class="n">speedchange</span><span class="p">;</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">playspeedmod</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Sample_Offset <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Offset/Sample_Offset.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Offset/Sample_Offset.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Sample_Offsetexpand' onclick='javascript:toggleDisplay(Sample_Offset, Sample_Offsetexpand, Sample_Offsetcollapse)'>show sketch</button>
<button id='Sample_Offsetcollapse' style='display:none' onclick='javascript:toggleDisplay(Sample_Offset, Sample_Offsetexpand, Sample_Offsetcollapse)'>hide sketch</button></p>

<div id='Sample_Offset' style='display:none'>
<figure class='code'><figcaption><span> (Sample_Offset.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Sample_Offset/Sample_Offset.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of crude &quot;scraping&quot; through a sampled sound</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates starting a sample with an offset.</span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  todo: use a window function to do it smoothly</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/burroughs1_18649_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 512</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">offset_advance</span> <span class="o">=</span><span class="mi">4</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">);</span> <span class="c1">// play at the speed it was recorded</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setLoopingOn</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">offset</span> <span class="o">+=</span> <span class="n">offset_advance</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// keep offset in range</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&gt;=</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">)</span> <span class="n">offset</span> <span class="o">-=</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">offset</span> <span class="o">+=</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// choose a new offfset_advance amount now and again</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">offset_advance</span> <span class="o">=</span> <span class="mi">2</span><span class="o">+</span><span class="n">rand</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="n">offset_advance</span> <span class="o">=</span> <span class="o">-</span><span class="n">offset_advance</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">offset</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Samples <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples/Samples.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples/Samples.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Samplesexpand' onclick='javascript:toggleDisplay(Samples, Samplesexpand, Samplescollapse)'>show sketch</button>
<button id='Samplescollapse' style='display:none' onclick='javascript:toggleDisplay(Samples, Samplesexpand, Samplescollapse)'>hide sketch</button></p>

<div id='Samples' style='display:none'>
<figure class='code'><figcaption><span> (Samples.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Samples/Samples.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of playing sampled sounds,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates one-shot samples scheduled</span>
</span><span class='line'><span class="cm"> *  with EventDelay(), and fast random numbers with </span>
</span><span class='line'><span class="cm"> *  xorshift96() and rand(), a more friendly wrapper for xorshift96().</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_00_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_01_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_02_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span><span class="n">aBamboo0</span><span class="p">(</span><span class="n">BAMBOO_00_2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_01_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span><span class="n">aBamboo1</span><span class="p">(</span><span class="n">BAMBOO_01_2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_02_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span><span class="n">aBamboo2</span><span class="p">(</span><span class="n">BAMBOO_02_2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling audio gain changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kTriggerDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aBamboo0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">);</span> <span class="c1">// play at the speed it was recorded at</span>
</span><span class='line'>  <span class="n">aBamboo1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_01_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_01_2048_NUM_CELLS</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aBamboo2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_02_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_02_2048_NUM_CELLS</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// countdown ms, within resolution of CONTROL_RATE</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">randomGain</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//return lowByte(xorshift96())&lt;&lt;1;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">rand</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="o">+</span> <span class="mi">55</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// referencing members from a struct is meant to be a bit faster than seperately</span>
</span><span class='line'><span class="c1">// ....haven&#39;t actually tested it here...</span>
</span><span class='line'><span class="k">struct</span> <span class="n">gainstruct</span><span class="p">{</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gain0</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gain1</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gain2</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">gains</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">switch</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>      <span class="n">gains</span><span class="p">.</span><span class="n">gain0</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
</span><span class='line'>      <span class="n">aBamboo0</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>      <span class="n">gains</span><span class="p">.</span><span class="n">gain1</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
</span><span class='line'>      <span class="n">aBamboo1</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>      <span class="n">gains</span><span class="p">.</span><span class="n">gain2</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
</span><span class='line'>      <span class="n">aBamboo2</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span><span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span>
</span><span class='line'>    <span class="p">((</span><span class="kt">long</span><span class="p">)</span> <span class="n">aBamboo0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gains</span><span class="p">.</span><span class="n">gain0</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aBamboo1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gains</span><span class="p">.</span><span class="n">gain1</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aBamboo2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gains</span><span class="p">.</span><span class="n">gain2</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//clip to keep audio loud but still in range</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">asig</span> <span class="o">&gt;</span> <span class="mi">243</span><span class="p">)</span> <span class="n">asig</span> <span class="o">=</span> <span class="mi">243</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">asig</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">244</span><span class="p">)</span> <span class="n">asig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">244</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Samples_Tables_Arrays <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples_Tables_Arrays/Samples_Tables_Arrays.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples_Tables_Arrays/Samples_Tables_Arrays.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Samples_Tables_Arraysexpand' onclick='javascript:toggleDisplay(Samples_Tables_Arrays, Samples_Tables_Arraysexpand, Samples_Tables_Arrayscollapse)'>show sketch</button>
<button id='Samples_Tables_Arrayscollapse' style='display:none' onclick='javascript:toggleDisplay(Samples_Tables_Arrays, Samples_Tables_Arraysexpand, Samples_Tables_Arrayscollapse)'>hide sketch</button></p>

<div id='Samples_Tables_Arrays' style='display:none'>
<figure class='code'><figcaption><span> (Samples_Tables_Arrays.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Samples_Tables_Arrays/Samples_Tables_Arrays.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a polyphonic sketch in which </span>
</span><span class='line'><span class="cm"> *  11 sound tables are shared between 3 voices,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates use of Sample() objects as players, </span>
</span><span class='line'><span class="cm"> *  using setTable() to share many sound tables between </span>
</span><span class='line'><span class="cm"> *  a few players, to minimise processing in updateAudio().</span>
</span><span class='line'><span class="cm"> *  Shows how to use Samples and sound tables in arrays,</span>
</span><span class='line'><span class="cm"> *  EventDelay() for scheduling, and rand() to select </span>
</span><span class='line'><span class="cm"> *  sound tables and vary the gain of each player.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt; </span><span class="c1">// for rand()</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_00_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_01_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_02_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_03_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_04_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_05_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_06_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_07_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_08_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_09_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_10_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling samples to play</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kTriggerDelay</span><span class="p">;</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kTriggerSlowDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">ms_per_note</span> <span class="o">=</span> <span class="mi">111</span><span class="p">;</span> <span class="c1">// subject to CONTROL_RATE</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">NUM_PLAYERS</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// 3 seems to be enough</span>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">NUM_TABLES</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">[</span><span class="n">NUM_PLAYERS</span><span class="p">]</span> <span class="o">=</span><span class="p">{</span>
</span><span class='line'>  <span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">BAMBOO_00_2048_DATA</span><span class="p">),</span>
</span><span class='line'>  <span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_01_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">BAMBOO_01_2048_DATA</span><span class="p">),</span>
</span><span class='line'>  <span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_02_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">BAMBOO_02_2048_DATA</span><span class="p">),</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// watch out - tables are const (but you can choose which ones you reference)</span>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">tables</span><span class="p">[</span><span class="n">NUM_TABLES</span><span class="p">]</span> <span class="o">=</span><span class="p">{</span>
</span><span class='line'>  <span class="n">BAMBOO_00_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_01_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_02_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_03_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_04_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_05_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_06_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_07_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_08_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_09_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_10_2048_DATA</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// gains for each sample player</span>
</span><span class='line'><span class="n">byte</span> <span class="n">gain</span><span class="p">[</span><span class="n">NUM_PLAYERS</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_PLAYERS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>  <span class="c1">// play at the speed they&#39;re sampled at</span>
</span><span class='line'>    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">ms_per_note</span><span class="p">);</span> <span class="c1">// countdown ms, within resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">kTriggerSlowDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">ms_per_note</span><span class="o">*</span><span class="mi">6</span><span class="p">);</span> <span class="c1">// resolution-dependent inaccuracy leads to polyrhythm :)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">randomGain</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">80</span><span class="p">,(</span><span class="n">byte</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">byte</span> <span class="n">player</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">gain</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
</span><span class='line'>    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">setTable</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="n">rand</span><span class="p">(</span><span class="n">NUM_TABLES</span><span class="p">)]);</span>
</span><span class='line'>    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="n">player</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">player</span><span class="o">==</span><span class="n">NUM_PLAYERS</span><span class="p">)</span> <span class="n">player</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerSlowDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">gain</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
</span><span class='line'>    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">setTable</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="n">rand</span><span class="p">(</span><span class="n">NUM_TABLES</span><span class="p">)]);</span>
</span><span class='line'>    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="n">player</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">player</span><span class="o">==</span><span class="n">NUM_PLAYERS</span><span class="p">)</span> <span class="n">player</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">kTriggerSlowDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">asig</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">byte</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_PLAYERS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>    <span class="n">asig</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">gain</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">asig</span> <span class="o">&gt;&gt;=</span> <span class="mi">6</span><span class="p">;</span> <span class="c1">// shift into usable range</span>
</span><span class='line'>  <span class="c1">//clip any stray peaks to max output range</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">constrain</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">asig</span><span class="p">,</span><span class="o">-</span><span class="mi">244</span><span class="p">,</span><span class="mi">243</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Wavetable_Swap <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Wavetable_Swap/Wavetable_Swap.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Wavetable_Swap/Wavetable_Swap.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Wavetable_Swapexpand' onclick='javascript:toggleDisplay(Wavetable_Swap, Wavetable_Swapexpand, Wavetable_Swapcollapse)'>show sketch</button>
<button id='Wavetable_Swapcollapse' style='display:none' onclick='javascript:toggleDisplay(Wavetable_Swap, Wavetable_Swapexpand, Wavetable_Swapcollapse)'>hide sketch</button></p>

<div id='Wavetable_Swap' style='display:none'>
<figure class='code'><figcaption><span> (Wavetable_Swap.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Wavetable_Swap/Wavetable_Swap.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example swapping between sounds played by a single Oscil</span>
</span><span class='line'><span class="cm"> *  with Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates declaring an Oscil without a table,</span>
</span><span class='line'><span class="cm"> *  and Oscil::setTable() method.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Created by Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// tables need to be the same size</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin512_int8.h&gt; </span>
</span><span class='line'><span class="cp">#include &lt;tables/saw_analogue512_int8.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// declare with or without a wavetable, and use setTable() later</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">512</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling table swaps</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kSwapTablesDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">boolean</span> <span class="n">using_sin</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kSwapTablesDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// 1 second countdown, within resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">aOscil</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">440.f</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">kSwapTablesDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">using_sin</span><span class="p">){</span>
</span><span class='line'>        <span class="n">aOscil</span><span class="p">.</span><span class="n">setTable</span><span class="p">(</span><span class="n">SAW_ANALOGUE512_DATA</span><span class="p">);</span>
</span><span class='line'>        <span class="n">using_sin</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>         <span class="n">aOscil</span><span class="p">.</span><span class="n">setTable</span><span class="p">(</span><span class="n">SIN512_DATA</span><span class="p">);</span>
</span><span class='line'>         <span class="n">using_sin</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">kSwapTablesDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aOscil</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='09.Delays'>
09.Delays</a></h2>


<hr />

<p>AudioDelay <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelay/AudioDelay.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelay/AudioDelay.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='AudioDelayexpand' onclick='javascript:toggleDisplay(AudioDelay, AudioDelayexpand, AudioDelaycollapse)'>show sketch</button>
<button id='AudioDelaycollapse' style='display:none' onclick='javascript:toggleDisplay(AudioDelay, AudioDelayexpand, AudioDelaycollapse)'>hide sketch</button></p>

<div id='AudioDelay' style='display:none'>
<figure class='code'><figcaption><span> (AudioDelay.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/AudioDelay/AudioDelay.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of modulating a signal by using a variable delay,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates AudioDelay.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_analogue512_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;AudioDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt; </span><span class="c1">// for mtof</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 256 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFreq</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">AudioDelay</span> <span class="o">&lt;</span><span class="mi">256</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">del_samps</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">60.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kFreq</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.63f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">del_samps</span> <span class="o">=</span> <span class="mi">128</span><span class="o">+</span><span class="n">kFreq</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span> <span class="n">del_samps</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>AudioDelayFeedback <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback/AudioDelayFeedback.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback/AudioDelayFeedback.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='AudioDelayFeedbackexpand' onclick='javascript:toggleDisplay(AudioDelayFeedback, AudioDelayFeedbackexpand, AudioDelayFeedbackcollapse)'>show sketch</button>
<button id='AudioDelayFeedbackcollapse' style='display:none' onclick='javascript:toggleDisplay(AudioDelayFeedback, AudioDelayFeedbackexpand, AudioDelayFeedbackcollapse)'>hide sketch</button></p>

<div id='AudioDelayFeedback' style='display:none'>
<figure class='code'><figcaption><span> (AudioDelayFeedback.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/AudioDelayFeedback/AudioDelayFeedback.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of flanging,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates AudioDelayFeedback.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012-13.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_analogue512_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle512_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;AudioDelayFeedback.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt; </span><span class="c1">// for mtof</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples</span>
</span><span class='line'>
</span><span class='line'><span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// the delay time, measured in samples, updated in updateControl, and used in updateAudio </span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">del_samps</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">48.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kDelSamps</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.163f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)</span>
</span><span class='line'>  <span class="n">aDel</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// can be -128 to 127</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">deltime</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// delay time range from 0 to 127 samples, @ 16384 samps per sec = 0 to 7 milliseconds</span>
</span><span class='line'>  <span class="c1">//del_samps = 64+kDelSamps.next();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// delay time range from 1 to 33 samples, @ 16384 samps per sec = 0 to 2 milliseconds</span>
</span><span class='line'>  <span class="c1">//del_samps = 17+kDelSamps.next()/8;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">deltime</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">kDelSamps</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again</span>
</span><span class='line'>  <span class="c1">//return asig/8 + aDel.next(asig, del_samps); // mix some straight signal with the delayed signal</span>
</span><span class='line'>  <span class="c1">//return aDel.next(aTriangle.next(), del_samps); // instead of the previous 2 lines for only the delayed signal</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="o">/</span><span class="mi">8</span> <span class="o">+</span> <span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig</span><span class="p">,</span> <span class="n">deltime</span><span class="p">);</span> <span class="c1">// mix some straight signal with the delayed signal</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>AudioDelayFeedbackAllpass <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackAllpass/AudioDelayFeedbackAllpass.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackAllpass/AudioDelayFeedbackAllpass.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='AudioDelayFeedbackAllpassexpand' onclick='javascript:toggleDisplay(AudioDelayFeedbackAllpass, AudioDelayFeedbackAllpassexpand, AudioDelayFeedbackAllpasscollapse)'>show sketch</button>
<button id='AudioDelayFeedbackAllpasscollapse' style='display:none' onclick='javascript:toggleDisplay(AudioDelayFeedbackAllpass, AudioDelayFeedbackAllpassexpand, AudioDelayFeedbackAllpasscollapse)'>hide sketch</button></p>

<div id='AudioDelayFeedbackAllpass' style='display:none'>
<figure class='code'><figcaption><span> (AudioDelayFeedbackAllpass.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/AudioDelayFeedbackAllpass/AudioDelayFeedbackAllpass.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of allpass interpolation for fractional delays,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates AudioDelayFeedback with allpass interpolation,</span>
</span><span class='line'><span class="cm"> *  random delaytimes and feedback levels on a </span>
</span><span class='line'><span class="cm"> *  (random) percussive adsr whitenoise sound.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012-13.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;AudioDelayFeedback.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Ead.h&gt; </span><span class="c1">// exponential attack decay</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/whitenoise8192_int8.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">WHITENOISE8192_DATA</span><span class="p">);</span> <span class="c1">// audio noise</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span>  <span class="n">kDelay</span><span class="p">;</span> <span class="c1">// for triggering envelope start</span>
</span><span class='line'><span class="n">Ead</span> <span class="n">kEnvelope</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// resolution will be CONTROL_RATE</span>
</span><span class='line'>
</span><span class='line'><span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">256</span><span class="p">,</span> <span class="n">ALLPASS</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">gain</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(115200);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs</span>
</span><span class='line'>  <span class="c1">// use float to set freq because it will be small and fractional</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">AUDIO_RATE</span><span class="o">/</span><span class="n">WHITENOISE8192_SAMPLERATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// jump around in audio noise table to disrupt obvious looping</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setPhase</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">uint</span><span class="p">)</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="c1">// set random adsr parameters</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">500u</span><span class="p">)</span><span class="o">+</span><span class="mi">200</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">75</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">decay</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">-</span> <span class="n">attack</span><span class="p">;</span>
</span><span class='line'>    <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// set random delay parameters</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">del_cells</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">(</span><span class="mi">65535u</span><span class="p">)</span><span class="o">/</span><span class="mi">256</span><span class="p">;</span>
</span><span class='line'>    <span class="n">aDel</span><span class="p">.</span><span class="n">setDelayTimeCells</span><span class="p">(</span><span class="n">del_cells</span><span class="p">);</span> <span class="c1">// Allpass interpolation for fractional delay time</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">fb</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
</span><span class='line'>    <span class="n">aDel</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="n">fb</span><span class="p">);</span>
</span><span class='line'>    <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">duration</span><span class="o">+</span><span class="mi">500</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">gain</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">kEnvelope</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">((</span><span class="n">gain</span><span class="o">*</span><span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>AudioDelayFeedbackX2 <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackX2/AudioDelayFeedbackX2.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackX2/AudioDelayFeedbackX2.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='AudioDelayFeedbackX2expand' onclick='javascript:toggleDisplay(AudioDelayFeedbackX2, AudioDelayFeedbackX2expand, AudioDelayFeedbackX2collapse)'>show sketch</button>
<button id='AudioDelayFeedbackX2collapse' style='display:none' onclick='javascript:toggleDisplay(AudioDelayFeedbackX2, AudioDelayFeedbackX2expand, AudioDelayFeedbackX2collapse)'>hide sketch</button></p>

<div id='AudioDelayFeedbackX2' style='display:none'>
<figure class='code'><figcaption><span> (AudioDelayFeedbackX2.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/AudioDelayFeedbackX2/AudioDelayFeedbackX2.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of flanging,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates 2 oscillators going through 2 AudioDelayFeedback units,</span>
</span><span class='line'><span class="cm"> *  with straight signal mixed in.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012-13.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_analogue512_int8.h&gt; </span><span class="c1">// wavetable for audio</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle512_int8.h&gt; </span><span class="c1">// wavetable for delay sweep</span>
</span><span class='line'><span class="cp">#include &lt;AudioDelayFeedback.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt; </span><span class="c1">// for mtof</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle1</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle2</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps1</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps2</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples</span>
</span><span class='line'>
</span><span class='line'><span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel1</span><span class="p">;</span>
</span><span class='line'><span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// the delay time, measured in samples, updated in updateControl, and used in updateAudio </span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">del_samps1</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">del_samps2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aTriangle1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">48.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kDelSamps1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.163f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)</span>
</span><span class='line'>  <span class="n">aDel1</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// can be -128 to 127</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">aTriangle2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">52.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kDelSamps2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.43f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)</span>
</span><span class='line'>  <span class="n">aDel2</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="mi">109</span><span class="p">);</span> <span class="c1">// can be -128 to 127</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// delay time range from 0 to 127 samples, @ 16384 samps per sec = 0 to 7 milliseconds</span>
</span><span class='line'>  <span class="n">del_samps1</span> <span class="o">=</span> <span class="mi">64</span><span class="o">+</span><span class="n">kDelSamps1</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// delay time range from 1 to 33 samples, @ 16384 samps per sec = 0 to 2 milliseconds</span>
</span><span class='line'>  <span class="n">del_samps2</span> <span class="o">=</span> <span class="mi">17</span><span class="o">+</span><span class="n">kDelSamps2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig1</span> <span class="o">=</span> <span class="n">aTriangle1</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">aflange1</span> <span class="o">=</span> <span class="p">(</span><span class="n">asig1</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">aDel1</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig1</span><span class="p">,</span> <span class="n">del_samps1</span><span class="p">);</span> <span class="c1">// mix some straignt signal with the delayed signal</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig2</span> <span class="o">=</span> <span class="n">aTriangle2</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">aflange2</span> <span class="o">=</span> <span class="p">(</span><span class="n">asig2</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">aDel2</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig2</span><span class="p">,</span> <span class="n">del_samps2</span><span class="p">);</span> <span class="c1">// mix some straignt signal with the delayed signal</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">aflange1</span> <span class="o">+</span> <span class="n">aflange2</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>AudioDelayFeedback_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback_HIFI/AudioDelayFeedback_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback_HIFI/AudioDelayFeedback_HIFI.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='AudioDelayFeedback_HIFIexpand' onclick='javascript:toggleDisplay(AudioDelayFeedback_HIFI, AudioDelayFeedback_HIFIexpand, AudioDelayFeedback_HIFIcollapse)'>show sketch</button>
<button id='AudioDelayFeedback_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(AudioDelayFeedback_HIFI, AudioDelayFeedback_HIFIexpand, AudioDelayFeedback_HIFIcollapse)'>hide sketch</button></p>

<div id='AudioDelayFeedback_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (AudioDelayFeedback_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/AudioDelayFeedback_HIFI/AudioDelayFeedback_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of flanging,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates AudioDelayFeedback.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012-13.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_analogue512_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle512_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;AudioDelayFeedback.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt; </span><span class="c1">// for mtof</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples</span>
</span><span class='line'>
</span><span class='line'><span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// the delay time, measured in samples, updated in updateControl, and used in updateAudio </span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">del_samps</span><span class="p">;</span>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">del_samps_fractional</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">48.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kDelSamps</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.163f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)</span>
</span><span class='line'>  <span class="n">aDel</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// can be -128 to 127</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// delay time range from 0 to 127 samples, @ 16384 samps per sec = 0 to 7 milliseconds</span>
</span><span class='line'>  <span class="c1">//del_samps = 64+kDelSamps.next();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// delay time range from 1 to 33 samples, @ 16384 samps per sec = 0 to 2 milliseconds</span>
</span><span class='line'>  <span class="c1">//del_samps = 17+kDelSamps.next()/8;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">del_samps_fractional</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">kDelSamps</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again</span>
</span><span class='line'>  <span class="c1">//return asig/8 + aDel.next(asig, del_samps); // mix some straight signal with the delayed signal</span>
</span><span class='line'>  <span class="c1">//return aDel.next(aTriangle.next(), del_samps); // instead of the previous 2 lines for only the delayed signal</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">asig</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig</span><span class="p">,</span> <span class="n">del_samps_fractional</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// mix some straight signal with the delayed signal</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>ReverbTank_STANDARD <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/ReverbTank_STANDARD/ReverbTank_STANDARD.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/ReverbTank_STANDARD/ReverbTank_STANDARD.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='ReverbTank_STANDARDexpand' onclick='javascript:toggleDisplay(ReverbTank_STANDARD, ReverbTank_STANDARDexpand, ReverbTank_STANDARDcollapse)'>show sketch</button>
<button id='ReverbTank_STANDARDcollapse' style='display:none' onclick='javascript:toggleDisplay(ReverbTank_STANDARD, ReverbTank_STANDARDexpand, ReverbTank_STANDARDcollapse)'>hide sketch</button></p>

<div id='ReverbTank_STANDARD' style='display:none'>
<figure class='code'><figcaption><span> (ReverbTank_STANDARD.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/ReverbTank_STANDARD/ReverbTank_STANDARD.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of reverb on a synthesised sound</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates ReverbTank, a reverb small enough to fit on</span>
</span><span class='line'><span class="cm"> *  the Arduino Nano, which for some reason wasn&#39;t able to fit a larger version</span>
</span><span class='line'><span class="cm"> *  which did fit on other 328 based boards.</span>
</span><span class='line'><span class="cm"> *  It&#39;s a pretty horrible reverb which sounds like the inside of a tin can.</span>
</span><span class='line'><span class="cm"> *  For simplicity, ReverbTank has hardcoded maximum delay sizes</span>
</span><span class='line'><span class="cm"> *  but also has default delay times which can be changed in the constructor</span>
</span><span class='line'><span class="cm"> *  or by setting during run time to allow live tweaking.</span>
</span><span class='line'><span class="cm"> *  The synthesised sound comes from the phasemod synth example.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 for STANDARD output on a Uno or similar, or</span>
</span><span class='line'><span class="cm"> *  see the readme.md file for others.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ReverbTank.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/envelop2048_uint8.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">ReverbTank</span> <span class="n">reverb</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 512 </span><span class="c1">// quite fast, keeps modulation smooth</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Synth from PhaseMod_Envelope example</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModWidth</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">ENVELOP2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aEnvelop</span><span class="p">(</span><span class="n">ENVELOP2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// synth params</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">55</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kModFreq1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">3.98f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kModFreq2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">3.31757f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModWidth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.52434f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aEnvelop</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">9.0f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// synth control</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">277.0f</span> <span class="o">+</span> <span class="mf">0.4313f</span><span class="o">*</span><span class="n">kModFreq1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">kModFreq2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">synth</span> <span class="o">=</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">150u</span><span class="o">+</span><span class="n">aModWidth</span><span class="p">.</span><span class="n">next</span><span class="p">()));</span>
</span><span class='line'>  <span class="n">synth</span> <span class="o">*=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">aEnvelop</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">synth</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// here&#39;s the reverb</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">arev</span> <span class="o">=</span> <span class="n">reverb</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">synth</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// add the dry and wet signals</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">synth</span> <span class="o">+</span> <span class="p">(</span><span class="n">arev</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='10.Audio_Filters'>
10.Audio_Filters</a></h2>


<hr />

<p>LowPassFilter <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilter/LowPassFilter.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilter/LowPassFilter.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='LowPassFilterexpand' onclick='javascript:toggleDisplay(LowPassFilter, LowPassFilterexpand, LowPassFiltercollapse)'>show sketch</button>
<button id='LowPassFiltercollapse' style='display:none' onclick='javascript:toggleDisplay(LowPassFilter, LowPassFilterexpand, LowPassFiltercollapse)'>hide sketch</button></p>

<div id='LowPassFilter' style='display:none'>
<figure class='code'><figcaption><span> (LowPassFilter.ino)</span> <a href='/Mozzi/downloads/code/examples/10.Audio_Filters/LowPassFilter/LowPassFilter.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of filtering a wave,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates LowPassFilter().</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/chum9_int8.h&gt; </span><span class="c1">// recorded audio wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// for filter modulation</span>
</span><span class='line'><span class="cp">#include &lt;LowPassFilter.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">CHUM9_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound</span><span class="p">(</span><span class="n">CHUM9_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">LowPassFilter</span> <span class="n">lpf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCrunchySound</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.3f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span> <span class="c1">// about once every half second</span>
</span><span class='line'>    <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="o">/</span><span class="mi">64</span><span class="p">);</span>  <span class="c1">// choose a new modulation frequency</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">// map the modulation into the filter range (0-255)</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">kFilterMod</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">lpf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aCrunchySound</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>LowPassFilterX2 <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilterX2/LowPassFilterX2.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilterX2/LowPassFilterX2.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='LowPassFilterX2expand' onclick='javascript:toggleDisplay(LowPassFilterX2, LowPassFilterX2expand, LowPassFilterX2collapse)'>show sketch</button>
<button id='LowPassFilterX2collapse' style='display:none' onclick='javascript:toggleDisplay(LowPassFilterX2, LowPassFilterX2expand, LowPassFilterX2collapse)'>hide sketch</button></p>

<div id='LowPassFilterX2' style='display:none'>
<figure class='code'><figcaption><span> (LowPassFilterX2.ino)</span> <a href='/Mozzi/downloads/code/examples/10.Audio_Filters/LowPassFilterX2/LowPassFilterX2.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of filtering 2 waves with different filter settings,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates 2 Oscillators, each with a LowPassFilter().</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/chum9_int8.h&gt; </span><span class="c1">// recorded audio wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos512_int8.h&gt; </span><span class="c1">// for filter modulation</span>
</span><span class='line'><span class="cp">#include &lt;LowPassFilter.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt; </span><span class="c1">// for rand()</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">CHUM9_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound1</span><span class="p">(</span><span class="n">CHUM9_DATA</span><span class="p">);</span> <span class="c1">//audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">CHUM9_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound2</span><span class="p">(</span><span class="n">CHUM9_DATA</span><span class="p">);</span> <span class="c1">//audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod1</span><span class="p">(</span><span class="n">COS512_DATA</span><span class="p">);</span> <span class="c1">// to modulate filter frequency</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod2</span><span class="p">(</span><span class="n">COS512_DATA</span><span class="p">);</span> <span class="c1">// to modulate filter frequency</span>
</span><span class='line'>
</span><span class='line'><span class="n">LowPassFilter</span> <span class="n">lpf1</span><span class="p">;</span>
</span><span class='line'><span class="n">LowPassFilter</span> <span class="n">lpf2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCrunchySound1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCrunchySound2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">6.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kFilterMod1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.3f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kFilterMod2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.1f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">lpf1</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">180</span><span class="p">);</span>
</span><span class='line'>  <span class="n">lpf2</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">220</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// map the modulation depth into the filter range, 0-255 to represent 0-8192 Hz</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">cutoff_freq1</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">kFilterMod1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// 100 ± 63</span>
</span><span class='line'>  <span class="n">lpf1</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq1</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// also update lpf2 cutoff</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">cutoff_freq2</span> <span class="o">=</span> <span class="mi">70</span> <span class="o">+</span> <span class="n">kFilterMod2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span> <span class="c1">// 70 ± 31</span>
</span><span class='line'>  <span class="n">lpf2</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq2</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(((</span><span class="kt">char</span><span class="p">)</span><span class="n">lpf1</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aCrunchySound1</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">lpf2</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aCrunchySound2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>StateVariableFilter <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/StateVariableFilter/StateVariableFilter.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/StateVariableFilter/StateVariableFilter.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='StateVariableFilterexpand' onclick='javascript:toggleDisplay(StateVariableFilter, StateVariableFilterexpand, StateVariableFiltercollapse)'>show sketch</button>
<button id='StateVariableFiltercollapse' style='display:none' onclick='javascript:toggleDisplay(StateVariableFilter, StateVariableFilterexpand, StateVariableFiltercollapse)'>hide sketch</button></p>

<div id='StateVariableFilter' style='display:none'>
<figure class='code'><figcaption><span> (StateVariableFilter.ino)</span> <a href='/Mozzi/downloads/code/examples/10.Audio_Filters/StateVariableFilter/StateVariableFilter.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of filtering a wave,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates StateVariable().</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 (on a Uno or similar), or </span>
</span><span class='line'><span class="cm"> *  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/whitenoise8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// for filter modulation</span>
</span><span class='line'><span class="cp">#include &lt;StateVariable.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt; </span><span class="c1">// for rand()</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">WHITENOISE8192_DATA</span><span class="p">);</span> <span class="c1">// audio noise</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">StateVariable</span> <span class="o">&lt;</span><span class="n">NOTCH</span><span class="o">&gt;</span> <span class="n">svf</span><span class="p">;</span> <span class="c1">// can be LOWPASS, BANDPASS, HIGHPASS or NOTCH</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// cast to float because the resulting freq will be small and fractional</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">AUDIO_RATE</span><span class="o">/</span><span class="n">WHITENOISE8192_SAMPLERATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.3f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">svf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mf">25.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">svf</span><span class="p">.</span><span class="n">setCentreFreq</span><span class="p">(</span><span class="mf">1200.f</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span> <span class="c1">// about once every half second</span>
</span><span class='line'>    <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="o">/</span><span class="mi">64</span><span class="p">);</span>  <span class="c1">// choose a new modulation frequency</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="kt">float</span> <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="mf">2200.f</span> <span class="o">+</span> <span class="n">kFilterMod</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="p">;</span>
</span><span class='line'>  <span class="n">svf</span><span class="p">.</span><span class="n">setCentreFreq</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// watch output levels, they can distort if too high</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">svf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='11.Communication'>
11.Communication</a></h2>


<hr />

<p>Mozzi_Processing_Serial <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='Mozzi_Processing_Serialexpand' onclick='javascript:toggleDisplay(Mozzi_Processing_Serial, Mozzi_Processing_Serialexpand, Mozzi_Processing_Serialcollapse)'>show sketch</button>
<button id='Mozzi_Processing_Serialcollapse' style='display:none' onclick='javascript:toggleDisplay(Mozzi_Processing_Serial, Mozzi_Processing_Serialexpand, Mozzi_Processing_Serialcollapse)'>hide sketch</button></p>

<div id='Mozzi_Processing_Serial' style='display:none'>
<figure class='code'><figcaption><span> (Mozzi_Processing_Serial.ino)</span> <a href='/Mozzi/downloads/code/examples/11.Communication/Mozzi_Processing_Serial/Mozzi_Processing_Serial.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">  Modified from Arduino &gt; Examples &gt; Communication &gt; Dimmer</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Demonstrates the sending data from the computer to the Arduino board,</span>
</span><span class='line'><span class="cm"> in this case to control the frequency of an oscillator.  The data is sent</span>
</span><span class='line'><span class="cm"> in individual bytes, each of which ranges from 0 to 255.  Arduino</span>
</span><span class='line'><span class="cm"> reads these bytes and uses them to set the frequency of the oscillator.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Circuit: Audio output on digital pin 9. (STANDARD mode in mozzi_config.h)</span>
</span><span class='line'><span class="cm"> Serial connection to Processing, Max/MSP, or another serial application</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Dimmer example created 2006</span>
</span><span class='line'><span class="cm"> by David A. Mellis</span>
</span><span class='line'><span class="cm"> modified 30 Aug 2011</span>
</span><span class='line'><span class="cm"> by Tom Igoe and Scott Fitzgerald</span>
</span><span class='line'><span class="cm"> Adapted for Mozzi by Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> http://www.arduino.cc/en/Tutorial/Dimmer</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// uses default control rate of 64</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// check if data has been sent from the computer:</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// read the most recent byte (which will be from 0 to 255):</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
</span><span class='line'>    <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="mi">100</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// return an int signal centred around 0</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Processing code for this example</span>
</span><span class='line'><span class="cm"> // Dimmer - sends bytes over a serial port</span>
</span><span class='line'><span class="cm"> // by David A. Mellis</span>
</span><span class='line'><span class="cm"> //This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> import processing.serial.*;</span>
</span><span class='line'><span class="cm"> Serial port;</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> void setup() {</span>
</span><span class='line'><span class="cm"> size(256, 150);</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> println(&quot;Available serial ports:&quot;);</span>
</span><span class='line'><span class="cm"> println(Serial.list());</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> // Uses the first port in this list (number 0).  Change this to</span>
</span><span class='line'><span class="cm"> // select the port corresponding to your Arduino board.  The last</span>
</span><span class='line'><span class="cm"> // parameter (e.g. 115200) is the speed of the communication.  It</span>
</span><span class='line'><span class="cm"> // has to correspond to the value passed to Serial.begin() in your</span>
</span><span class='line'><span class="cm"> // Arduino sketch.</span>
</span><span class='line'><span class="cm"> port = new Serial(this, Serial.list()[0], 115200);  </span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> // If you know the name of the port used by the Arduino board, you</span>
</span><span class='line'><span class="cm"> // can specify it directly like this.</span>
</span><span class='line'><span class="cm"> //port = new Serial(this, &quot;COM1&quot;, 115200);</span>
</span><span class='line'><span class="cm"> }</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> void draw() {</span>
</span><span class='line'><span class="cm"> // draw a gradient from black to white</span>
</span><span class='line'><span class="cm"> for (int i = 0; i &lt; 256; i++) {</span>
</span><span class='line'><span class="cm"> stroke(i);</span>
</span><span class='line'><span class="cm"> line(i, 0, i, 150);</span>
</span><span class='line'><span class="cm"> }</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> // write the current X-position of the mouse to the serial port as</span>
</span><span class='line'><span class="cm"> // a single byte</span>
</span><span class='line'><span class="cm"> port.write(mouseX);</span>
</span><span class='line'><span class="cm"> }</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Max/MSP v5 patch for this example</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">----------begin_max5_patcher----------</span>
</span><span class='line'><span class="cm">1008.3ocuXszaiaCD9r8uhA5rqAeHIa0aAMaAVf1S6hdoYQAsDiL6JQZHQ2M</span>
</span><span class='line'><span class="cm">YWr+2KeX4vjnjXKKkKhhiGQ9MeyCNz+X9rnMp63sQvuB+MLa1OlOalSjUvrC</span>
</span><span class='line'><span class="cm">ymEUytKuh05TKJWUWyk5nE9eSyuS6jesvHu4F4MxOuUzB6X57sPKWVzBLXiP</span>
</span><span class='line'><span class="cm">xZtGj6q2vafaaT0.BzJfjj.p8ZPukazsQvpfcpFs8mXR3plh8BoBxURIOWyK</span>
</span><span class='line'><span class="cm">rxspZ0YI.eTCEh5Vqp+wGtFXZMKe6CZc3yWZwTdCmYW.BBkdiby8v0r+ST.W</span>
</span><span class='line'><span class="cm">sD9SdUkn8FYspPbqvnBNFtZWiUyLmleJWo0vuKzeuj2vpJLaWA7YiE7wREui</span>
</span><span class='line'><span class="cm">FpDFDp1KcbAFcP5sJoVxp4NB5Jq40ougIDxJt1wo3GDZHiNocKhiIExx+owv</span>
</span><span class='line'><span class="cm">AdOEAksDs.RRrOoww1Arc.9RvN2J9tamwjkcqknvAE0l+8WnjHqreNet8whK</span>
</span><span class='line'><span class="cm">z6mukIK4d+Xknv3jstvJs8EirMMhxsZIusET25jXbX8xczIl5xPVxhPcTGFu</span>
</span><span class='line'><span class="cm">xNDu9rXtUCg37g9Q8Yc+EuofIYmg8QdkPCrOnXsaHwYs3rWx9PGsO+pqueG2</span>
</span><span class='line'><span class="cm">uNQBqWFh1X7qQG+3.VHcHrfO1nyR2TlqpTM9MDsLKNCQVz6KO.+Sfc5j1Ykj</span>
</span><span class='line'><span class="cm">jzkn2jwNDRP7LVb3d9LtoWBAOnvB92Le6yRmZ4UF7YpQhiFi7A5Ka8zXhKdA</span>
</span><span class='line'><span class="cm">4r9TRGG7V4COiSbAJKdXrWNhhF0hNUh7uBa4Mba0l7JUK+omjDMwkSn95Izr</span>
</span><span class='line'><span class="cm">TOwkdp7W.oPRmNRQsiKeu4j3CkfVgt.NYPEYqMGvvJ48vIlPiyzrIuZskWIS</span>
</span><span class='line'><span class="cm">xGJPcmPiWOfLodybH3wjPbMYwlbFIMNHPHFOtLBNaLSa9sGk1TxMzCX5KTa6</span>
</span><span class='line'><span class="cm">WIH2ocxSdngM0QPqFRxyPHFsprrhGc9Gy9xoBjz0NWdR2yW9DUa2F85jG2v9</span>
</span><span class='line'><span class="cm">FgTO4Q8qiC7fzzQNpmNpsY3BrYPVJBMJQ1uVmoItRhw9NrVGO3NMNzYZ+zS7</span>
</span><span class='line'><span class="cm">3WTvTOnUydG5kHMKLqAOjTe7fN2bGSxOZDkMrBrGQ9J1gONBEy0k4gVo8qHc</span>
</span><span class='line'><span class="cm">cxmfxVihWz6a3yqY9NazzUYkua9UnynadOtogW.JfsVGRVNEbWF8I+eHtcwJ</span>
</span><span class='line'><span class="cm">+wLXqZeSdWLo+FQF6731Tva0BISKTx.cLwmgJsUTTvkg1YsnXmxDge.CDR7x</span>
</span><span class='line'><span class="cm">D6YmX6fMznaF7kdczmJXwm.XSOOrdoHhNA7GMiZYLZZR.+4lconMaJP6JOZ8</span>
</span><span class='line'><span class="cm">ftCs1YWHZI3o.sIXezX5ihMSuXzZtk3ai1mXRSczoCS32hAydeyXNEu5SHyS</span>
</span><span class='line'><span class="cm">xqZqbd3ZLdera1iPqYxOm++v7SUSz</span>
</span><span class='line'><span class="cm">-----------end_max5_patcher-----------</span>
</span><span class='line'><span class="cm"> */</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Sinewave_PWM_leds_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/11.Communication/Sinewave_PWM_leds_HIFI/Sinewave_PWM_leds_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/11.Communication/Sinewave_PWM_leds_HIFI/Sinewave_PWM_leds_HIFI.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Sinewave_PWM_leds_HIFIexpand' onclick='javascript:toggleDisplay(Sinewave_PWM_leds_HIFI, Sinewave_PWM_leds_HIFIexpand, Sinewave_PWM_leds_HIFIcollapse)'>show sketch</button>
<button id='Sinewave_PWM_leds_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(Sinewave_PWM_leds_HIFI, Sinewave_PWM_leds_HIFIexpand, Sinewave_PWM_leds_HIFIcollapse)'>hide sketch</button></p>

<div id='Sinewave_PWM_leds_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (Sinewave_PWM_leds_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/11.Communication/Sinewave_PWM_leds_HIFI/Sinewave_PWM_leds_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing a sinewave </span>
</span><span class='line'><span class="cm"> *  and changing the brightness of 3 leds</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates the use of Oscil for audio and control,</span>
</span><span class='line'><span class="cm"> *  and a way to do PWM on digital pins without disrupting audio.</span>
</span><span class='line'><span class="cm"> *  Control oscillators are used here to modulate the brightness of the leds</span>
</span><span class='line'><span class="cm"> *  between 0-255.</span>
</span><span class='line'><span class="cm"> *  With AUDIO_RATE at 16384 Hz, this gives a 64 Hz pwm duty cycle.</span>
</span><span class='line'><span class="cm"> *  If there is visible flicker, the resolution of the pwm could be made lower,</span>
</span><span class='line'><span class="cm"> *  or the AUDIO_RATE could be increased to 32768 Hz, if the</span>
</span><span class='line'><span class="cm"> *  cpu isn&#39;t too busy.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm"> *  be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm"> *  In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm"> *  #define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm"> *  //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm"> *  to</span>
</span><span class='line'><span class="cm"> *  //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm"> *  #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm"> *  Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *                   3.9k </span>
</span><span class='line'><span class="cm"> *   pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm"> *                     1M           |</span>
</span><span class='line'><span class="cm"> *   pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm"> *                                     |</span>
</span><span class='line'><span class="cm"> *                           4.7n  ==</span>
</span><span class='line'><span class="cm"> *                                     |</span>
</span><span class='line'><span class="cm"> *                                 ground</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Resistors are ±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm"> *  from a batch of whatever you can get.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  LEDs:</span>
</span><span class='line'><span class="cm"> *  Red led from pin 3 through a 1.5k resistor to ground</span>
</span><span class='line'><span class="cm"> *  Green led from pin 4 through a 1.5k resistor to ground</span>
</span><span class='line'><span class="cm"> *  Blue led from pin 5 through a 1.5k resistor to ground</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012-13.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// LED pins, use 0-7 for PORTD, otherwise change to PORTB in updateRGB</span>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">RED_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">GREEN_PIN</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">BLUE_PIN</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">red_brightness</span><span class="p">,</span> <span class="n">green_brightness</span><span class="p">,</span> <span class="n">blue_brightness</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// control oscillators using sinewaves to modulate LED brightness</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kRed</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kGreen</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kBlue</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateRGB</span><span class="p">(</span><span class="n">byte</span> <span class="n">r</span><span class="p">,</span> <span class="n">byte</span> <span class="n">g</span><span class="p">,</span> <span class="n">byte</span> <span class="n">b</span><span class="p">){</span>
</span><span class='line'>  <span class="c1">// stagger pwm counter starts to try to reduce combined flicker</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">byte</span> <span class="n">red_count</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">byte</span> <span class="n">green_count</span><span class="o">=</span><span class="mi">85</span><span class="p">;</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">byte</span> <span class="n">blue_count</span><span class="o">=</span><span class="mi">170</span><span class="p">;</span>
</span><span class='line'><span class="c1">// PORTD maps to Arduino digital pins 0 to 7</span>
</span><span class='line'><span class="c1">// http://playground.arduino.cc/Learning/PortManipulation</span>
</span><span class='line'>  <span class="p">(</span><span class="n">red_count</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">r</span><span class="p">)</span> <span class="o">?</span> <span class="n">PORTD</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">RED_PIN</span><span class="p">)</span> <span class="o">:</span> <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">RED_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="p">(</span><span class="n">green_count</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">g</span><span class="p">)</span> <span class="o">?</span> <span class="n">PORTD</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">GREEN_PIN</span><span class="p">)</span> <span class="o">:</span> <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">GREEN_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="p">(</span><span class="n">blue_count</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">)</span> <span class="o">?</span> <span class="n">PORTD</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">BLUE_PIN</span><span class="p">)</span> <span class="o">:</span> <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">BLUE_PIN</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">RED_PIN</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">GREEN_PIN</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">BLUE_PIN</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// set led brightness modulation frequencies</span>
</span><span class='line'>  <span class="n">kRed</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.21f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kGreen</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.3f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kBlue</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.27f</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// set audio oscil frequency</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// uses the default control rate of 64, defined in mozzi_config.h</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">red_brightness</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="n">kRed</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">green_brightness</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="n">kGreen</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">blue_brightness</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="n">kBlue</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">updateRGB</span><span class="p">(</span><span class="n">red_brightness</span><span class="p">,</span> <span class="n">green_brightness</span><span class="p">,</span> <span class="n">blue_brightness</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// this would make more sense with a higher resolution signal</span>
</span><span class='line'>  <span class="c1">// but still benefits from using HIFI to avoid the 16kHz pwm noise</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="c1">// 8 bits scaled up to 14 bits</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Teensy_USB_MIDI_Input <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/11.Communication/Teensy_USB_MIDI_Input/Teensy_USB_MIDI_Input.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/11.Communication/Teensy_USB_MIDI_Input/Teensy_USB_MIDI_Input.mp3?raw=true' preload='auto'></source> echo Your browser does not support the audio element.</audio><br/>
<button type='button' id='Teensy_USB_MIDI_Inputexpand' onclick='javascript:toggleDisplay(Teensy_USB_MIDI_Input, Teensy_USB_MIDI_Inputexpand, Teensy_USB_MIDI_Inputcollapse)'>show sketch</button>
<button id='Teensy_USB_MIDI_Inputcollapse' style='display:none' onclick='javascript:toggleDisplay(Teensy_USB_MIDI_Input, Teensy_USB_MIDI_Inputexpand, Teensy_USB_MIDI_Inputcollapse)'>hide sketch</button></p>

<div id='Teensy_USB_MIDI_Input' style='display:none'>
<figure class='code'><figcaption><span> (Teensy_USB_MIDI_Input.ino)</span> <a href='/Mozzi/downloads/code/examples/11.Communication/Teensy_USB_MIDI_Input/Teensy_USB_MIDI_Input.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a sound being triggered by MIDI input.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates playing notes with Mozzi in response to MIDI input,</span>
</span><span class='line'><span class="cm"> *  using the version of the Arduino MIDI library which</span>
</span><span class='line'><span class="cm"> *  works with Teensy boards (http://www.pjrc.com/teensy/td_midi.html).  </span>
</span><span class='line'><span class="cm"> *  Tested on a Teensy2++, which can be used as a MIDI device </span>
</span><span class='line'><span class="cm"> *  without any extra parts.  </span>
</span><span class='line'><span class="cm"> *  The sketch would be almost the same with the mainstream</span>
</span><span class='line'><span class="cm"> *  MIDI library (using MIDI as a prefix to calls instead of usbMIDI).</span>
</span><span class='line'><span class="cm"> *  This sketch won&#39;t compile on the Teensy2++ if you also </span>
</span><span class='line'><span class="cm"> *  have the mainstream MIDI library installed.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: On the Teensy2++, audio output is on pin B5.  Midi input on usb.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2013.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MIDI.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt; </span><span class="c1">// for envelope</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ADSR.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio sinewave oscillator</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// envelope generator</span>
</span><span class='line'><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define LED 6 </span><span class="c1">// 6 on Teensy++ 2.0, 11 on Teensy 2.0, to see if MIDI is being recieved</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOn</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//aSin.setFreq(mtof(note)); // simple but less accurate frequency</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">note</span><span class="p">)));</span> <span class="c1">// accurate frequency</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOff</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOff</span><span class="p">();</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Initiate MIDI communications, listen to all channels (not needed with Teensy usbMIDI)</span>
</span><span class='line'>  <span class="c1">//MIDI.begin(MIDI_CHANNEL_OMNI);    </span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Connect the HandleNoteOn function to the library, so it is called upon reception of a NoteOn.</span>
</span><span class='line'>  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">setHandleNoteOn</span><span class="p">(</span><span class="n">HandleNoteOn</span><span class="p">);</span>  <span class="c1">// Put only the name of the function</span>
</span><span class='line'>  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">setHandleNoteOff</span><span class="p">(</span><span class="n">HandleNoteOff</span><span class="p">);</span>  <span class="c1">// Put only the name of the function</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// 10000 is so the note will sustain 10 seconds unless a noteOff comes</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> <span class="c1">// default frequency</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>TwoWire_Read_ADXL345 <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='TwoWire_Read_ADXL345expand' onclick='javascript:toggleDisplay(TwoWire_Read_ADXL345, TwoWire_Read_ADXL345expand, TwoWire_Read_ADXL345collapse)'>show sketch</button>
<button id='TwoWire_Read_ADXL345collapse' style='display:none' onclick='javascript:toggleDisplay(TwoWire_Read_ADXL345, TwoWire_Read_ADXL345expand, TwoWire_Read_ADXL345collapse)'>hide sketch</button></p>

<div id='TwoWire_Read_ADXL345' style='display:none'>
<figure class='code'><figcaption><span> (TwoWire_Read_ADXL345.ino)</span> <a href='/Mozzi/downloads/code/examples/11.Communication/TwoWire_Read_ADXL345/TwoWire_Read_ADXL345.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example reading an ADXL345 accelerometer</span>
</span><span class='line'><span class="cm"> *  using I2C communication without blocking audio synthesis,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates use of twi_nonblock functions</span>
</span><span class='line'><span class="cm"> *  to replace processor-blocking Wire methods.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio output on digital pin 9.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Marije Baalman 2012.</span>
</span><span class='line'><span class="cm"> *  Small modifications by TIm Barrass to retain Mozzi compatibility.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;Ead.h&gt; </span><span class="c1">// exponential attack decay</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;twi_nonblock.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Ead</span> <span class="n">kEnvelope</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// resolution will be CONTROL_RATE</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">gain</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#define ADXL345_DEVICE (0x53)    </span><span class="c1">// ADXL345 device address</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define ADXL345_POWER_CTL 0x2d</span>
</span><span class='line'><span class="cp">#define ADXL345_DATA_FORMAT 0x31</span>
</span><span class='line'><span class="cp">#define ADXL345_DATAX0 0x32</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define ADXL345_THRESH_INACT 0x25</span>
</span><span class='line'><span class="cp">#define ADXL345_TIME_INACT 0x26</span>
</span><span class='line'><span class="cp">#define ADXL345_ACT_INACT_CTL 0x27</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="k">volatile</span> <span class="n">uint8_t</span> <span class="n">acc_status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="cp">#define ACC_IDLE 0</span>
</span><span class='line'><span class="cp">#define ACC_READING 1</span>
</span><span class='line'><span class="cp">#define ACC_WRITING 2</span>
</span><span class='line'>
</span><span class='line'><span class="n">uint8_t</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup_accelero</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">initialize_twi_nonblock</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">ADXL345_POWER_CTL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>  <span class="c1">// all registers off</span>
</span><span class='line'>  <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">ADXL345_POWER_CTL</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span> <span class="c1">// auto sleep on</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//   ADXL345_DATA_FORMAT : (self test)(spi)(int_invert)(0)(fullres)(justify)(range..)</span>
</span><span class='line'>  <span class="c1">//   11 //= B00001011</span>
</span><span class='line'>  <span class="n">acc_writeTo</span><span class="p">(</span> <span class="n">ADXL345_DATA_FORMAT</span><span class="p">,</span> <span class="mi">11</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the threshold for inactivity</span>
</span><span class='line'>  <span class="c1">//   acc_writeTo( ADXL345_THRESH_INACT, inactivityThreshold );</span>
</span><span class='line'>  <span class="c1">//   acc_writeTo( ADXL345_TIME_INACT, inactivityTime );</span>
</span><span class='line'>  <span class="c1">// 0B10001111</span>
</span><span class='line'>  <span class="c1">//   acc_writeTo( ADXL345_ACT_INACT_CTL, B10001111 ); </span>
</span><span class='line'>  <span class="c1">//   acc_writeTo(ADXL345_POWER_CTL, B00111000); </span>
</span><span class='line'>
</span><span class='line'>  <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">ADXL345_POWER_CTL</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>  <span class="c1">// auto sleep off, measure on</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_IDLE</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">/// ---------- non-blocking version ----------</span>
</span><span class='line'><span class="kt">void</span> <span class="n">initiate_read_accelero</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// Reads num bytes starting from address register on device in to _buff array</span>
</span><span class='line'>  <span class="c1">// indicate that we are transmitting</span>
</span><span class='line'>  <span class="c1">//   transmitting = 1;</span>
</span><span class='line'>  <span class="c1">// set address of targeted slave</span>
</span><span class='line'>  <span class="n">txAddress</span> <span class="o">=</span> <span class="n">ADXL345_DEVICE</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// reset tx buffer iterator vars</span>
</span><span class='line'>  <span class="n">txBufferIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">txBufferLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// put byte in tx buffer</span>
</span><span class='line'>  <span class="n">txBuffer</span><span class="p">[</span><span class="n">txBufferIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">ADXL345_DATAX0</span><span class="p">;</span>
</span><span class='line'>  <span class="o">++</span><span class="n">txBufferIndex</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// update amount in buffer   </span>
</span><span class='line'>  <span class="n">txBufferLength</span> <span class="o">=</span> <span class="n">txBufferIndex</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">twi_initiateWriteTo</span><span class="p">(</span><span class="n">txAddress</span><span class="p">,</span> <span class="n">txBuffer</span><span class="p">,</span> <span class="n">txBufferLength</span><span class="p">);</span>
</span><span class='line'>  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_WRITING</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">initiate_request_accelero</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// reset tx buffer iterator vars</span>
</span><span class='line'>  <span class="n">txBufferIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">txBufferLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// indicate that we are done transmitting</span>
</span><span class='line'>  <span class="c1">//   transmitting = 0;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">uint8_t</span> <span class="n">read</span> <span class="o">=</span> <span class="n">twi_initiateReadFrom</span><span class="p">(</span><span class="n">ADXL345_DEVICE</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span><span class='line'>  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_READING</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">finalise_request_accelero</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">uint8_t</span> <span class="n">read</span> <span class="o">=</span> <span class="n">twi_readMasterBuffer</span><span class="p">(</span> <span class="n">rxBuffer</span><span class="p">,</span> <span class="mi">6</span> <span class="p">);</span>
</span><span class='line'>  <span class="c1">// set rx buffer iterator vars</span>
</span><span class='line'>  <span class="n">rxBufferIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">rxBufferLength</span> <span class="o">=</span> <span class="n">read</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">uint8_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span> <span class="n">rxBufferLength</span> <span class="o">-</span> <span class="n">rxBufferIndex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>         <span class="c1">// device may send less than requested (abnormal)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">accbytedata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rxBuffer</span><span class="p">[</span><span class="n">rxBufferIndex</span><span class="p">];</span>
</span><span class='line'>    <span class="o">++</span><span class="n">rxBufferIndex</span><span class="p">;</span>
</span><span class='line'>    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_IDLE</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">/// ----end------ non-blocking version ----------</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Writes val to address register on device</span>
</span><span class='line'><span class="kt">void</span> <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">byte</span> <span class="n">address</span><span class="p">,</span> <span class="n">byte</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//   Wire.beginTransmission(ADXL345_DEVICE); // start transmission to device   </span>
</span><span class='line'>  <span class="n">twowire_beginTransmission</span><span class="p">(</span><span class="n">ADXL345_DEVICE</span><span class="p">);</span> <span class="c1">// start transmission to device   </span>
</span><span class='line'>  <span class="c1">//   Wire.send(address);             // send register address</span>
</span><span class='line'>  <span class="n">twowire_send</span><span class="p">(</span> <span class="n">address</span> <span class="p">);</span>
</span><span class='line'>  <span class="c1">//   Wire.send(val);                 // send value to write</span>
</span><span class='line'>  <span class="n">twowire_send</span><span class="p">(</span> <span class="n">val</span> <span class="p">);</span>
</span><span class='line'>  <span class="c1">//   Wire.endTransmission();         // end transmission</span>
</span><span class='line'>  <span class="n">twowire_endTransmission</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">setup_accelero</span><span class="p">();</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">800</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">attack</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">decay</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
</span><span class='line'>  <span class="n">kEnvelope</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">accx</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">accy</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">accz</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">envgain</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">envgain</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">kEnvelope</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span> <span class="n">envgain</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="p">){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="n">accx</span> <span class="o">&gt;</span> <span class="mi">512</span><span class="p">){</span>
</span><span class='line'>      <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span> <span class="mi">400</span> <span class="p">);</span>
</span><span class='line'>      <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">accy</span> <span class="o">&gt;</span> <span class="mi">512</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span> <span class="mi">800</span> <span class="p">);</span>
</span><span class='line'>      <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">accz</span> <span class="o">&gt;</span> <span class="mi">512</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span> <span class="mi">1200</span> <span class="p">);</span>
</span><span class='line'>      <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span> <span class="n">acc_status</span> <span class="p">){</span>
</span><span class='line'>  <span class="k">case</span> <span class="nl">ACC_IDLE:</span>
</span><span class='line'>    <span class="n">accx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">accbytedata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">256</span> <span class="o">+</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// accelerometer x reading</span>
</span><span class='line'>    <span class="n">accy</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">accbytedata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">256</span> <span class="o">+</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="c1">// accelerometer y reading</span>
</span><span class='line'>    <span class="n">accz</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">accbytedata</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="mi">256</span> <span class="o">+</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span> <span class="c1">// accelerometer z reading</span>
</span><span class='line'>    <span class="n">initiate_read_accelero</span><span class="p">();</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="nl">ACC_WRITING:</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="n">TWI_MTX</span> <span class="o">!=</span> <span class="n">twi_state</span> <span class="p">){</span>
</span><span class='line'>      <span class="n">initiate_request_accelero</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="nl">ACC_READING:</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="n">TWI_MRX</span> <span class="o">!=</span> <span class="n">twi_state</span> <span class="p">){</span>
</span><span class='line'>      <span class="n">finalise_request_accelero</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">gain</span> <span class="o">=</span> <span class="n">envgain</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<script language="JavaScript">
   function toggleDisplay(stuffToToggle,elementThatExpandsStuff,elementThatCollapsesStuff) {
      if ( stuffToToggle.style.display == 'none' ) {
         stuffToToggle.style.display = '';
         elementThatExpandsStuff.style.display = 'none';
         elementThatCollapsesStuff.style.display = '';
      }
      else {
         stuffToToggle.style.display = 'none';
         elementThatExpandsStuff.style.display = '';
         elementThatCollapsesStuff.style.display = 'none';
      }
   }
</script>


  
    <footer>
      
      
        <div class="sharing">
  
  <a href="/Mozzi//twitter.com/share" class="twitter-share-button" data-url="http://sensorium.github.io/Mozzi//examples/index.html" data-via="nothingperson" data-counturl="http://sensorium.github.io/Mozzi//examples/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/Mozzi/blog/2013/05/14/icad2013-workshop-announcement/">ICAD2013 Workshop Announcement</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2013/05/13/music-hack-day-barcelona-workshop-announcement/">Music Hack Day Barcelona Workshop Announcement</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2013/04/11/isea2013-workshop-announcement/">ISEA2013 Workshop Announcement</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Tim Barrass -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <span class="credit">Published with <a href="http://pages.github.com">GitHub Pages</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
